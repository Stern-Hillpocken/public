<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="style.css" />
        <title>Tashi - L'exode avant la tempête</title>

        <script type="text/javascript">
            var ressourcesName = ["wood", "plank", "stone", "ore", "fiber", "sail", "food"];
            var witchMenu = "";
            var ocarina = "";
            var sake = "";
            var constructator = [];//check is builded all
            var taxe = [1200, 40, 20];//Balancing
            var zepplin = 0;
            var statue = 0;

            var Player = {
                init(){
                    this.localisation;
                    this.workerAvaible = 6;
                    this.workerTotal = 6;
                    this.wounded = 0;
                    this.food = 6;
                    this.foodNextDay = 0;
                    this.wood = 0;
                    this.woodNextDay = 0;
                    this.plank = 0;
                    this.stone = 0;
                    this.stoneNextDay = 0;
                    this.ore = 0;
                    this.fiber = 0;
                    this.fiberNextDay = 0;
                    this.sail = 0;
                    this.weight;
                    this.weightMax;
                    this.needToChoose = true;
                    this.daysBeforeStorm = 0;
                    this.sacrificeMade = 0;
                    this.bookmarked = "unbook";
                    this.vision = [];
                },
                changeLocalisation(nbSpot, foodLost){
                    this.food -= foodLost;
                    this.daysBeforeStorm += board.daysBeforeStorm[nbSpot] + buildings.quantityTotal[buildings.name.indexOf("spinnaker")];
                    this.localisation = nbSpot;
                    update("ressources");
                }
            }
            var player = Object.create(Player);
            player.init();

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            var Board = {
                init(){
                    this.htmlTable; //Finished product
                    this.spotI=[];
                    this.spotJ=[];
                    this.spotClass=[]; //css
                    this.woodAvaible=[];
                    this.stoneAvaible=[];
                    this.foodAvaible=[];
                    this.fiberAvaible=[];
                    this.daysBeforeStorm=[];
                    this.foodLost=[];
                    //Pathway
                    let allMaps = [
                    "...........................x-x.............../...\\.........x-x-x-x-x-x-x...../.../.......\\.\\...x-x-x.........x-x-x.\\...\\......././.....x-x-x-x-x-x-x...........\\.../...............x-x...........................",
                    ".......................x-x-x...x-x......./.....\\./...\\.....x-x-x...x-x-x-x.../.....\\./.......\\.x.......x.........x.\\...../.\\......./...x-x-x...x-x-x-x.....\\...../.\\.../.......x-x-x...x-x.......................",
                    ".......................x-x.............../...\\.............x-x-x-x-x-x-x-x.../.\\./.\\.\\.......\\.x-x-x-x-x-x-x-x-x-x.\\./.\\././......./...x-x-x-x-x-x-x-x.....\\.../...............x-x...............................",
                    ".......................x................./.\\...............x-x-x-x...x-x-x.../.......\\./.\\./.\\.x.........x...x...x.\\......./.\\./.\\./...x-x-x-x...x-x-x.....\\./.................x................................."
                    ];// Double \ mean real \ for SE path
                    let rand = parseInt(Math.random()*4); //Nb of value possible (0 to 3)
                    let mapMorse = allMaps[rand];
                    //Tiles of the map
                    this.tiles = new Array();
                    for(i=0; i<11; i++)
                       this.tiles[i] = new Array();
                    for(i=0; i<11; i++)
                       for(j=0; j<19; j++){
                            this.tiles[i][j] = mapMorse[j+(i*19)]; //convert string to table
                            if(mapMorse[j+(i*19)] == "x"){this.spotI.push(i); this.spotJ.push(j);} //init spotI and spotJ for X
                        }
                    //Localisation of player
                    for(i=0; i<board.spotJ.length; i++){if(board.spotJ[i] === 0){player.localisation = i;}}
                    //Generate ressources
                    let nbSpot = (mapMorse.match(/x/g) || []).length; //Nb of x in mapMorse
                    for(i=0; i<nbSpot; i++){
                        this.generateRessources(i);
                    }
                    //Remove ressources where the player start
                    this.woodAvaible[player.localisation] = 0;
                    this.stoneAvaible[player.localisation] = 0;
                    this.foodAvaible[player.localisation] = 0;
                    this.fiberAvaible[player.localisation] = 0;
                    this.daysBeforeStorm[player.localisation] = 0;
                    //Generate correct html table to display
                    this.upClass(player.localisation);
                    this.generateHtmlTable();
                },
                generateRessources(nbSpot){//Balancing
                    this.spotClass.push("spot_unavailable");
                    let ressBase = [10, 10, 20];
                    ressBase[parseInt(Math.random()*3)] += 10;
                    this.woodAvaible.push(parseInt(Math.random()*20)+ressBase[0]);
                    this.stoneAvaible.push(parseInt(Math.random()*20)+ressBase[1]);
                    this.foodAvaible.push(parseInt(Math.random()*20)+ressBase[2]);
                    this.fiberAvaible.push(parseInt(Math.random()*20)+30);
                    if(this.spotJ[nbSpot] < 7){//First quarter of map
                        this.daysBeforeStorm.push(7);
                    }else if(this.spotJ[nbSpot] < 13){//Second
                        this.daysBeforeStorm.push(5);
                    }else{ //Last
                        this.daysBeforeStorm.push(3);
                    }
                    this.foodLost.push(parseInt(Math.random()*5)+4);
                },
                upClass(nbSpot){ 
                    for(i=0; i<this.spotClass.length; i++){
                        if(isSpotAvailable(i)){
                            this.spotClass[i] = "spot_available";
                        }else{
                            this.spotClass[i] = "spot_unavailable";
                        }
                    }
                    this.spotClass[player.localisation] = "spot_here";
                    this.spotClass[nbSpot] = "spot_selected";
                },
                generateHtmlTable(){
                    let countX = 0;
                    this.htmlTable = "<table id=table_map>"
                    for(i=0; i<11; i++){
                        this.htmlTable += "<tr>";
                        for(j=0; j<19; j++){
                            if(board.tiles[i][j] == "x"){
                                let iconMap = board.tiles[i][j];
                                let NSFIJ = this.calcNbSpotFromIJ(i,j);
                                if(board.woodAvaible[NSFIJ] >= board.stoneAvaible[NSFIJ] && board.woodAvaible[NSFIJ] >= board.fiberAvaible[NSFIJ]/1.5){
                                    iconMap = "<img src=images/tiles/wood-spot.png width=32px>";
                                }else if(board.stoneAvaible[NSFIJ] >= board.woodAvaible[NSFIJ] && board.stoneAvaible[NSFIJ] >= board.fiberAvaible[NSFIJ]/1.5){
                                    iconMap = "<img src=images/tiles/stone-spot.png width=32px>";
                                }else{
                                    iconMap = "<img src=images/tiles/fiber-spot.png width=32px>";
                                }
                                if(j === 0){iconMap = "<img src=images/tiles/start.png width=32px>";}
                                if(j === 18){iconMap = "<img src=images/tiles/end.png width=32px>";}
                                if(board.spotClass[countX] === "spot_here"){iconMap = "<img src=images/tiles/here.png width=32px>";}
                                this.htmlTable += "<td title=\"";
                                if(j != 18 && j != 0){
                                    this.htmlTable += "Cliquer pour plus d’informations";
                                }else if(j === 0){this.htmlTable += "Les ruines de ton village";}
                                else{this.htmlTable += "Forteresse des montagnes";}
                                this.htmlTable += "\" style=\"cursor:pointer\" onclick='updateStat("+countX+"); board.upClass("+countX+"); update(\"map\");' class='" +board.spotClass[countX]+ "'>"+ iconMap +"</td>";
                                countX++;
                            }else if(board.tiles[i][j] == "."){
                                this.htmlTable += "<td> </td>";
                            }else if(board.tiles[i][j] == "-"){
                                this.htmlTable += "<td><img ";
                                if(j != board.spotJ[player.localisation]+1 || i != board.spotI[player.localisation]){this.htmlTable += "class=pathway_unpraticable ";}
                                this.htmlTable += "src=images/tiles/dash.png width=32px></td>";
                            }else if(board.tiles[i][j] == "/"){
                                this.htmlTable += "<td><img ";
                                if(j != board.spotJ[player.localisation]+1 || i != board.spotI[player.localisation]-1){this.htmlTable += "class=pathway_unpraticable ";}
                                this.htmlTable += "src=images/tiles/slash.png width=32px></td>";
                            }else if(board.tiles[i][j] == "\\"){
                                this.htmlTable += "<td><img ";
                                if(j != board.spotJ[player.localisation]+1 || i != board.spotI[player.localisation]+1){this.htmlTable += "class=pathway_unpraticable ";}
                                this.htmlTable += "src=images/tiles/backslash.png width=32px></td>";
                            }else{
                                this.htmlTable += "<td>"+ board.tiles[i][j] +"</td>";
                            }
                        }
                        this.htmlTable += "</tr>";
                    }
                    this.htmlTable += "</table>";
                },
                calcNbSpotFromIJ(i,j){
                    let nb;
                    var nbI = [];
                    var idx = this.spotI.indexOf(i);
                    while (idx != -1) {
                      nbI.push(idx);
                      idx = this.spotI.indexOf(i, idx + 1);
                    }
                    var nbJ = [];
                    var jdx = this.spotJ.indexOf(j);
                    while (jdx != -1) {
                      nbJ.push(jdx);
                      jdx = this.spotJ.indexOf(j, jdx + 1);
                    }
                    nb = nbI.filter(element => nbJ.includes(element));
                    return nb;
                }
            };
            var board = Object.create(Board);
            board.init();

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            var Tool = {
                init(){
                    this.quantityAvailable=[0,0];//wood and ore
                    this.quantityTotal=[0,0];
                    this.weight = 1;
                },
                add(type, avaOrTot){
                    if(avaOrTot === "available"){this.quantityAvailable[type] ++;}
                    else{this.quantityTotal[type] ++; this.quantityAvailable[type] ++;}
                },
                remove(type, avaOrTot){
                    if(avaOrTot === "available"){this.quantityAvailable[type] --;}
                    else{this.quantityAvailable[type] --; this.quantityTotal[type] --;}
                },
                resetQuantity(){
                    this.quantityAvailable[0] = this.quantityTotal[0];
                    this.quantityAvailable[1] = this.quantityTotal[1];
                },
                addDurability(nbMax){
                    this.durabilityAvailable = nbMax;
                    this.durabilityMax = nbMax;
                }
            }
            var axe = Object.create(Tool);
            axe.init();
            axe.addDurability(0);
            var pickaxe = Object.create(Tool);
            pickaxe.init();
            var basket = Object.create(Tool);
            basket.init();

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            var Buildings = {
                init(){
                    this.name = ["toolstation", "furnace", "loom", "saw", "saw-windmill", "furnace-windmill", "loom-windmill", "wagon", "wagon-large", "spinnaker", "rope", "crossbow", "fortification", "beacon", "trap"];
                    this.nameFr = ["Atelier", "Four", "Métier à tisser", "Scierie mobile", "Scierie à vent", "Fonderie à vent", "Métier à tisser à vent", "Chariot à voile", "Barque à voile", "Voile supplémentaire", "Bout d'amarrage", "Cranequin tripode", "Fortification temporaire", "Mât roseau", "Piège"];
                    this.description = ["Table avec tous les accessoires nécessaires pour créer des outils",
                    "Assemblage de pierres avec une cavité sur l’avant pour fondre la roche en minerais",
                    "Cadre en bois avec navettes et aiguilles, attendant les fils pour tisser des voiles",
                    "Table avec une scie circulaire en son centre, activable au pied pour transformer le bois en planche",
                    "Table avec une scie circulaire activée par le vent",
                    "Four à l’efficacité augmentée par l’apport de la force du vent",
                    "Tissage et couture plus rapide grâce à la force du vent",
                    "Véhicule permettant le transport de plus de marchandises, +200 "+img("weight"),
                    "Version plus large du chariot à voile, +400 "+img("weight"),
                    "Augmente la vitesse lors de déplacements de lieu en lieu, faisant gagner des jours sur la tempête",
                    "Coradage et épieux évitant que le vent emporte les ressources",
                    "Arbalète sur pieds vitale à la défense du camp lors d’attaques pirates",
                    "Petit mur en chevron protégeant du vent et des pirates",
                    "Permet d’indiquer sa position aux personnes dans les steppes (alliés, marchands, pirates)",
                    "Mécanisme simple pouvant capturer des animaux"];
                    this.quantityAvailable = [];
                    this.quantityTotal = [];
                    this.durabilityAvailable = [];
                    this.durabilityMax = [4, 3, 3, 3, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0];
                    for(i=0; i<this.name.length; i++){
                        this.quantityAvailable[i] = 0;
                        this.quantityTotal[i] = 0;
                        this.durabilityAvailable[i] = 0;
                    }
                    this.woodCost =     [4, 0, 2, 2, 0, 0, 0, 3, 5, 0, 1, 3, 3, 4, 1];
                    this.plankCost =    [0, 0, 3, 3, 0, 0, 0, 6,10, 0, 0, 4, 2, 0, 0];
                    this.stoneCost =    [2, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 2, 1];
                    this.oreCost =      [0, 0, 2, 3, 0, 0, 0, 2, 4, 3, 0, 6, 0, 0, 0];
                    this.fiberCost =    [0, 0, 0, 0, 0, 0, 0, 8,12, 6, 4, 2, 0, 2, 4];
                    this.sailCost =     [0, 0, 0, 0, 2, 2, 2, 4, 6, 3, 0, 0, 0, 2, 0];
                    this.weight = [];
                    for(i=0; i<this.name.length; i++){
                        this.weight[i] = this.woodCost[i]*8 +  this.plankCost[i]*2 + this.stoneCost[i]*6 + this.oreCost[i]*2 + this.fiberCost[i]*0 + this.sailCost[i]*3;
                    }
                },
                img(value){
                    if(Number.isInteger(value)){return "<img src=images/buildings/"+this.name[value]+".png title='"+this.nameFr[value]+"' width=32px>";}
                    else{return "<img src=images/buildings/"+value+".png title=\""+this.nameFr[this.name.indexOf(value)]+"\" width=32px>";}
                },
                price(p){
                    let r = "";
                    if(this.name[p] === "saw-windmill" || this.name[p] === "furnace-windmill" || this.name[p] === "loom-windmill"){
                        r += this.img(this.name[p].match("([a-z]*)")[0])+" + "+this.sailCost[p]+" "+img("sail");
                    }else{
                        if(this.woodCost[p] > 0){r += " + " +this.woodCost[p]+ " "+img("wood");}
                        if(this.plankCost[p] > 0){r += " + " +this.plankCost[p]+ " "+img("plank");}
                        if(this.stoneCost[p] > 0){r += " + " +this.stoneCost[p]+ " "+img("stone");}
                        if(this.oreCost[p] > 0){r += " + " +this.oreCost[p]+ " "+img("ore");}
                        if(this.fiberCost[p] > 0){r += " + " +this.fiberCost[p]+ " "+img("fiber");}
                        if(this.sailCost[p] > 0){r += " + " +this.sailCost[p]+ " "+img("sail");}
                    r = r.slice(3);
                    }
                    r += " + "+img("worker");
                    return r;
                },
                buildButton(p, unbook){
                    let r = "<button onclick='build(buildings.name["+p+"], "+p+"); update(\"ressources\"); update(\""+witchMenu+"\"); ";
                    if(unbook === "unbook"){ r+= "player.bookmarked=\"unbook\"; ";}
                    r += " updateStat("+player.localisation+"); constructator["+p+"] = 1;' ";
                    if(this.name[p] === "saw-windmill" || this.name[p] === "furnace-windmill" || this.name[p] === "loom-windmill"){
                        if(this.quantityTotal[this.name.indexOf(this.name[p].match("([a-z]*)")[0])] === 0 || this.sailCost[p] > player.sail || player.workerAvaible === 0 || player.needToChoose){r += "class=unclicable DISABLED";}
                    }else{
                        if(this.woodCost[p] > player.wood || this.plankCost[p] > player.plank || this.stoneCost[p] > player.stone || this.oreCost[p] > player.ore || this.fiberCost[p] > player.fiber || this.sailCost[p] > player.sail || player.workerAvaible === 0 || player.needToChoose || player.daysBeforeStorm === 0){r += "class=unclicable DISABLED";}
                    }
                    r += ">Construire</button>";
                    return r;
                }
            }
            var buildings = Object.create(Buildings);
            buildings.init();
            //buildings.quantityAvailable[buildings.name.indexOf("furnace")]

            //Tips dislayed only one time (when tipDisplayed=false)
            var tipName = ["map", "inventory", "gather", "building", "tools", "refine", "stock", "secondToLastDay", "tooHeavy"];
            var tipDescription = ["Te voilà à étudier la carte des steppes alentours, ou plus précisément des chemins possibles pour arriver à la forteresse des montagnes la plus proche. Tu déroules la carte et la maintiens de part et d’autre : à proximité de ton pouce gauche, tu identifies votre localisation et à l’extrême droite, ta destination, la forteresse.<br>En pointant chaque lieu d’intérêt, des informations les concernant te reviennent en mémoire comme la quantité de ressources présentes. Tu estimes alors les doses de nourriture que vous devrez consommer pendant le voyage.<br>Tu ne peux bien sûr déplacer l’ensemble du convoi que de lieu adjacent en lieu adjacent car ce serait une folie de passer à travers un lieu d’intérêt sans s’y arrêter. Il faudra également veiller à ne laisser personne derrière et partir avant que la "+definitionOf("guguwa")+" ne vous rattrape.<br>Choisis un lieu et rendez-vous y.",
            "Tu arrives à te souvenir grossièrement des quantités de ressources présentes dans chaque lieu mais cette perception n’est que trop floue. Pour plus de précision, tu peux envoyer un ou deux "+definitionOf("aikin")+" pour connaître exactement les quantités de ressources du lieu où vous vous situez actuellement, ou sur le ou les lieux qui sont adjacents. Cela pourra t’aider à planifier votre prochain déplacement.",
            "Les premiers rayons du "+definitionOf("rana")+" passant à travers le "+definitionOf("zuriya mayafi")+" te réveillent un peu trop tôt ce matin. Tu t’extirpes des voiles et sors à l’extérieur de cet abri de fortune.<br>Vous voici dans ce nouveau lieu rempli de ressources à ramasser. Tu peux directement partir récolter ou bien tu pourrais envoyer les survivants cueillir ces richesses, mais tu sais qu’ils seront plus efficaces avec des outils. Cependant, avant même d’essayer de faire des outils il faut aller en <span class=important_txt>Construction</span> pour fabriquer un <span class=important_txt>Atelier</span> qui vous permettra de confectionner ces objets précieux.<br>Dernière chose très importante : récolter prend du temps. Les ressources ne seront donc disponibles <span class=important_txt>que pour le lendemain</span>, et seulement si il y en a encore dans ce lieu.",
            "C’est dans cet espace dégagé que tu peux construire les différentes structures dont vous aurez besoin pour vous faciliter la vie mais également pour vous défendre. Les structures mettent du temps à être fabriquées, c’est pourquoi tu ne pourras les utiliser <span class=important_txt>qu’à partir du lendemain</span>. De plus une personne sera mobilisée pour la construction durant toute la journée.<br>Commence à construire un <span class=important_txt>Atelier</span>, et tu reviendras plus tard pour une <span class=important_txt>Scierie</span>.<br>Tu devrais ensuite envoyer les autres récolter de la nourriture.",
            "Avec au moins un <span class=important_txt>Atelier</span> construit, tu peux assigner des personnes à la fabrication d’outils te permettant une meilleure récolte. La personne assignée <span class=important_txt>l’est pour la journée</span>, et elle peut fabriquer différents outils qui seront disponibles immédiatement. Elle ne pourra cependant confectionner que quelques outils par jour. Si tu as besoin de plus, construis un autre Atelier et assigne lui une autre personne pour la journée. Essaye en premier de bricoler un <span class=important_txt>Panier</span> pour faciliter la récolte de nourriture.",
            "Grâce aux différentes structures construites, tu vas pouvoir transformer les ressources brutes en biens manufacturés ayant d’autres utilités. Attention à ne pas tout convertir non plus, la polyvalence et la solidité des ressources brutes est tout aussi utile. Pour l’affinage, il faut également assigner une personne à une structure pour qu’elle puisse transformer les ressources, mais cela est épuisant. Construis d’autres structures pour affiner de nouveau ou attends le lendemain que ta structure soit à nouveau disponible.",
            "Du haut de ton mât, tu as une vue d’ensemble des ressources, des outils et des structures que vous avez apportés, récoltées ou fabriqués. Tu es capable d’évaluer le poids que cela représente ce qui est utile car, avec un seul <span class=important_txt>Chariot à voile</span>, vous ne pourrez pas transporter tout ce que vous accumulez. Pense à construire de nouveaux <span class=important_txt>Chariots à voile</span> pour pouvoir déplacer plus de choses lorsque vous migrerez de lieux en lieux.",
            "C’est le dernier jour que tu as à ta disposition avant que la "+definitionOf("guguwa")+" ne dévaste tout. Comme demain il faudra partir, il vaudrait mieux <span class=important_txt>amasser un maximum de nourriture</span> pour survivre au nouveau trajet.<br>Pense à bien surveiller et avoir en tête les jours restants ("+img("time")+") avant la "+definitionOf("guguwa")+" pour planifier au mieux tes actions et votre départ.",
            "Avec la récolte de ressources de la veille le poids de vos biens est supérieur à votre capacité de transport. Surveille ce poids ("+img("weight")+") en allant faire un tour dans votre <span class=important_txt>Stock</span> et en sacrifiant certaines ressources ou objets pour être plus léger et ainsi pouvoir quitter le lieu.<br>Sinon pour palier ce désagrément, il serait envisageable de construire un <span class=important_txt>Chariot à voile</span> permettant de transporter plus de choses."];
            var tipDisplayed = [false, false, false, false, false, false, false, false, false];
            function tipDisplay(menu){
                if(!tipDisplayed[tipName.indexOf(menu)]){
                    tipDisplayed[tipName.indexOf(menu)] = true;
                    return "<p class=tip>"+tipDescription[tipName.indexOf(menu)]+"</p>";
                }else{return '';}
            }
            var tutoStep=0;

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            
            function start(){
                //My axe and wagon
                axe.add(1, "total");
                buildings.quantityTotal[buildings.name.indexOf("wagon")] = 1;
                //Display HUD
                update("dashboard"); update("firstRessourcesChoice"); updateStat(player.localisation); update("ressources");
                document.getElementById("nav_div").innerHTML = "";
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function update(witchDiv){ // dashboard // main : map, gather, refine, tools, buildings, stock // stat // ressources
                var insideDiv = "";

                if(witchDiv == "dashboard"){
                    insideDiv = "<table><tr><td><button onclick='board.upClass(player.localisation);update(\"map\");updateStat(player.localisation);'";
                    if(player.needToChoose || tutoStep == 2){insideDiv += " class=unclicable DISABLED";}
                    else if(witchMenu === "map"){insideDiv += " class=menuSelected";}
                    insideDiv += ">Carte</button></td></tr>"
                    +"<tr><td><button onclick='update(\"gather\");updateStat(player.localisation);'";

                    if(player.needToChoose || tutoStep == 1 || player.daysBeforeStorm === 0){insideDiv += " class=unclicable DISABLED";}
                    else if(witchMenu === "gather"){insideDiv += " class=menuSelected";}
                    insideDiv += ">"+img("food")+" Récolte</button></td></tr>"
                    +"<tr><td><button onclick='update(\"refine\");updateStat(player.localisation);'";

                    if(player.needToChoose || tutoStep == 1 || tutoStep == 2 || player.daysBeforeStorm === 0){insideDiv += " class=unclicable DISABLED";}
                    else if(witchMenu === "refine"){insideDiv += " class=menuSelected";}
                    insideDiv += ">"+img("plank")+" Affinage</button></td></tr>"
                    +"<tr><td><button onclick='update(\"tools\");updateStat(player.localisation);'";

                    if(player.needToChoose || tutoStep == 1 || tutoStep == 2 || player.daysBeforeStorm === 0){insideDiv += " class=unclicable DISABLED";}
                    else if(witchMenu === "tools"){insideDiv += " class=menuSelected";}
                    insideDiv += ">"+img("pickaxe-ore")+" Outillage</button></td></tr>"
                    +"<tr><td><button onclick='update(\"building\");updateStat(player.localisation);'";

                    if(player.needToChoose || tutoStep == 1 || player.daysBeforeStorm === 0){insideDiv += " class=unclicable DISABLED";}
                    else if(witchMenu === "building"){insideDiv += " class=menuSelected";}
                    insideDiv += ">"+buildings.img("toolstation")+" Construction</button></td></tr>"
                    +"<tr><td><button onclick='update(\"stock\");updateStat(player.localisation);'";

                    if(player.needToChoose || tutoStep == 1 || tutoStep == 2){insideDiv += " class=unclicable DISABLED";}
                    else if(witchMenu === "stock"){insideDiv += " class=menuSelected";}
                    insideDiv += ">"+img("weight")+" Stock</button></td></tr>"
                    +"</table>";
                    document.getElementById('dashboard_div').innerHTML = insideDiv;
                }
////////////////
                else if(witchDiv == "firstRessourcesChoice"){
                    insideDiv = "<p>Grâce à une hache en métal récupérée dans l’enchevêtrement d’une "+definitionOf("sphéricage couronnée")+", tu arrives à dégager quelques corps enfouis sous les décombres des bâtiments. <span class=important_txt>Cinq personnes</span> en sortent miraculeusement vivantes.<br>De sous les débris du port tu arrives à extirper le "+definitionOf("Kaifi")+", un "+definitionOf("zuriya mayafi")+" pour quatre, mais vous vous entasserez pour voyager à son bord. Tu trouves également un <span class=important_txt>Chariot à voile</span> pour le transport de marchandises.<br>Tu as déjà perdu beaucoup de temps à récupérer tout ça, il faut se dépêcher, choisir une ruine de bâtiment à fouiller puis déguerpir. Tu estimes d’un coup d’œil ce qui vaut le coût. Si tu ne te souviens plus de ce qu’est cette ressource ou cet objet, tu peux toujours, pour en retrouver le nom passer les doigts dessus, cela te reviendra.<br>Quelle ruine veux-tu fouiller avant de partir ?</p>";
                    let bname =  ["Ferme", "Brise-vent", "Port", "Moulin", "Scierie", "Fonderie"];//Balancing
                    let bwood =  [6, 4, 4, 4, 6, 4];            for(i=0;i<bname.length;i++){bwood[i]+=parseInt(Math.random()*3)}
                    let bplank = [4, 3, 7, 3, 8, 2];            for(i=0;i<bname.length;i++){bplank[i]+=parseInt(Math.random()*4)}
                    let bstone = [2, 6, 2, 4, 2, 5];            for(i=0;i<bname.length;i++){bstone[i]+=parseInt(Math.random()*3)}
                    let bore =   [1, 2, 3, 3, 4, 6];            for(i=0;i<bname.length;i++){bore[i]+=parseInt(Math.random()*2)}
                    let bfiber = [8, 3, 6, 4, 2, 2];            for(i=0;i<bname.length;i++){bore[i]+=parseInt(Math.random()*4)}
                    let bsail =  [1, 1, 3, 3, 1, 1];            for(i=0;i<bname.length;i++){bore[i]+=parseInt(Math.random()*2)}
                    let bfood = [12, 6, 8,10, 6, 6];            for(i=0;i<bname.length;i++){bfood[i]+=parseInt(Math.random()*5)}
                    let rand = [parseInt(Math.random()*bname.length), parseInt(Math.random()*bname.length), parseInt(Math.random()*bname.length)];
                    let bowner = ["de Dassin", "de Ghumer", "de Kenwa", "de Ebeggi", "des jumeaux", "du "+definitionOf("sabo"), "de Ahar", "de Fodi"];
                    let randOwner;
                    insideDiv += "<div style='text-align:center;'>";
                    for(i=0; i<3; i++){
                        randOwner = parseInt(Math.random()*bowner.length);
                        insideDiv += "<div style='display:inline-block;border:2px solid white;text-align:center;padding: 4px;'>"+bname[rand[i]]+" "+bowner[randOwner]+"<table style=\"margin:auto\"><tr>";
                        insideDiv += "<td>"+(bwood[rand[i]]-parseInt(Math.random()*3))+" - "+(bwood[rand[i]]+parseInt(Math.random()*3+1))+"</td><td>"+img("wood")+"</td></tr>";
                        insideDiv += "<td>"+(bplank[rand[i]]-parseInt(Math.random()*3))+" - "+(bplank[rand[i]]+parseInt(Math.random()*3+1))+"</td><td>"+img("plank")+"</td></tr>";
                        insideDiv += "<td>"+(bstone[rand[i]]-parseInt(Math.random()*3))+" - "+(bstone[rand[i]]+parseInt(Math.random()*3+1))+"</td><td>"+img("stone")+"</td></tr>";
                        insideDiv += "<td>"+(bore[rand[i]]-parseInt(Math.random()*2))+" - "+(bore[rand[i]]+parseInt(Math.random()*2+1))+"</td><td>"+img("ore")+"</td></tr>";
                        insideDiv += "<td>"+(bfiber[rand[i]]-parseInt(Math.random()*2))+" - "+(bfiber[rand[i]]+parseInt(Math.random()*4+1))+"</td><td>"+img("fiber")+"</td></tr>";
                        insideDiv += "<td>"+(bsail[rand[i]]-parseInt(Math.random()*2))+" - "+(bsail[rand[i]]+parseInt(Math.random()*2+1))+"</td><td>"+img("sail")+"</td></tr>";
                        insideDiv += "<td>"+(bfood[rand[i]]-parseInt(Math.random()*3))+" - "+(bfood[rand[i]]+parseInt(Math.random()*3+1))+"</td><td>"+img("food")+"</td></tr>";
                        insideDiv += "<tr><td colspan=2><button onclick='player.wood += "+bwood[rand[i]]+"; player.plank += "+bplank[rand[i]]+";\
                        player.stone += "+bstone[rand[i]]+"; player.ore += "+bore[rand[i]]+"; player.fiber += "+bfiber[rand[i]]+"; player.sail += "+bsail[rand[i]]+"; player.food += "+bfood[rand[i]]+";\
                        player.needToChoose=false;\
                        tutoStep=1;\
                        update(\"ressources\");update(\"dashboard\");update(\"explication\");updateStat(player.localisation);'>Fouiller</button></td></tr></table></div> ";
                    }
                    insideDiv += "</div>";
                    document.getElementById('main_div').innerHTML = insideDiv;
                }
////////////////
                else if(witchDiv == "explication"){
                    insideDiv = "<p>Après avoir récupéré quelques ressources miraculeusement intactes, tu réfléchis aux options qui s’offrent à toi. Pour l’instant tu n’en vois qu’une de sensée : ouvrir ta carte des steppes et choisir la route la plus courte pour te rendre à la forteresse des montagnes la moins loin, sans perdre de temps.<br>Bien sûr, plus tard, dans les prochains lieux, il faudra mettre en place la <span class=important_txt>Récolte</span> de ressources pour survivre lors du "+definitionOf("tashi")+" et pour s’acquitter de <span class=important_txt>la taxe</span> imposée par la forteresse, mais ici tout a été arraché.<br>Tu pourras par la suite décider de transformer tes ressources brutes en ressources exploitables grâce à des structures d’<span class=important_txt>Affinage</span>, mais ici tu n’en as plus sous la main.<br>En amont, tu devras réapprendre l’art de l’<span class=important_txt>Outillage</span> car vous n’irez pas loin avec ta seule hache.<br>Il faudra également, pour survivre et faciliter de nombreuses tâches, effectuer la <span class=important_txt>Construction</span> de différentes structures. Mais ne perdons pas de temps à les faire ici.<br>Enfin, tu devras surveiller ton <span class=important_txt>Stock</span> de ressources, d’outils, et de structures, pour toujours pouvoir les transporter grâce aux chariots à voile… pour l’instant on ne va pas dire que vous êtes en excès de ressources.<br>Mais avant toute chose, ne reste pas ici, déplace toi sur la carte !</p>";
                    document.getElementById('main_div').innerHTML = insideDiv;
                }
////////////////
                else if(witchDiv == "map"){
                    witchMenu = "map"; update("dashboard");
                    board.generateHtmlTable();
                    board.htmlTable = "<h1>Carte</h1>" + tipDisplay("map") + board.htmlTable;//First to explain
                    if(player.daysBeforeStorm === 1){board.htmlTable = tipDisplay("secondToLastDay") + board.htmlTable;}
                    else if(player.weight > player.weightMax){board.htmlTable = tipDisplay("tooHeavy") + board.htmlTable;}
                    insideDiv = board.htmlTable;

                    if(tutoStep === 0){
                        insideDiv += "<br><br><h1>Inventorier</h1>";
                        insideDiv += tipDisplay("inventory");
                        insideDiv += "<p style=\"text-align:center;\"><button onclick='player.workerAvaible -=1; player.vision.push("+player.localisation+"); board.upClass(player.localisation); update(\"map\"); update(\"ressources\"); updateStat("+player.localisation+");' ";
                        if(player.vision.indexOf(player.localisation) != -1 || player.workerAvaible < 1){insideDiv += "class=unclicable DISABLED";}
                        insideDiv += ">Lieu actuel : "+img("worker")+"</button> ";
                        let visionToPush = [];
                        if(board.tiles[board.spotI[player.localisation]][board.spotJ[player.localisation]+1] === "-")
                        {visionToPush.push(board.calcNbSpotFromIJ(board.spotI[player.localisation],
                            board.spotJ[player.localisation]+2));}
                        if(board.tiles[board.spotI[player.localisation]-1][board.spotJ[player.localisation]+1] === "/")
                        {visionToPush.push(board.calcNbSpotFromIJ(board.spotI[player.localisation]-2,
                            board.spotJ[player.localisation]+2));}
                        if(board.tiles[board.spotI[player.localisation]+1][board.spotJ[player.localisation]+1] === "\\")
                        {visionToPush.push(board.calcNbSpotFromIJ(board.spotI[player.localisation]+2,
                            board.spotJ[player.localisation]+2));}  
                        insideDiv += "<button onclick='player.workerAvaible -=2; player.vision.push("+visionToPush+"); board.upClass(player.localisation); update(\"map\"); update(\"ressources\"); updateStat("+player.localisation+");' ";
                        if(player.vision.indexOf(board.calcNbSpotFromIJ(board.spotI[player.localisation], board.spotJ[player.localisation]+2)[0]) != -1 ||
                            player.vision.indexOf(board.calcNbSpotFromIJ(board.spotI[player.localisation]-2, board.spotJ[player.localisation]+2)[0]) != -1 ||
                            player.vision.indexOf(board.calcNbSpotFromIJ(board.spotI[player.localisation]+2, board.spotJ[player.localisation]+2)[0]) != -1 ||
                            player.workerAvaible < 2){insideDiv += "class=unclicable DISABLED";}
                        insideDiv += ">Lieux adjacents : "+img("worker")+" "+img("worker")+"</button></p>";
                    }
                    document.getElementById('main_div').innerHTML = insideDiv;
                }
////////////////
                else if(witchDiv == "gather"){
                    witchMenu = "gather"; update("dashboard");
                    insideDiv = "<h1>Récolter</h1>" + tipDisplay("gather");

                    for(i=0; i<4; i++){
                        let ressFr = ["Bois", "Roche", "Nourriture", "Fibre"];
                        let ressEn = ["wood", "stone", "food", "fiber"];
                        let objEn = ["axe", "pickaxe", "basket", "basket"];
                        let qnty = [axe.quantityAvailable, pickaxe.quantityAvailable, basket.quantityAvailable, basket.quantityAvailable];

                        insideDiv += "<table class=clipboard><th colspan=3>"+ressFr[i]+"</th>";
                        insideDiv += "<tr><td>"+img("worker")+"</td>\
                            <td><button onclick='gathering(\""+ressEn[i]+"\", 0, \"gather\")'";
                        if(!gathering(ressEn[i], 0, "cost")){insideDiv += " class=unclicable DISABLED";}
                        insideDiv += ">>>></button></td><td>+" + gathering(ressEn[i], 0, "gain") + " "+img(ressEn[i])+"</td></tr>";
                        //
                        insideDiv += "<tr><td>"+img("worker")+" + ";
                        if(i < 2){insideDiv += img(objEn[i]+"-wood");}
                        else{insideDiv += img(objEn[i]);}
                        insideDiv += "/" + qnty[i][0] + "</td>\
                            <td><button onclick='gathering(\""+ressEn[i]+"\", 1, \"gather\")'";
                        if(!gathering(ressEn[i], 1, "cost")){insideDiv += " class=unclicable DISABLED";}
                        insideDiv += ">>>></button></td><td>+" + gathering(ressEn[i], 1, "gain") + " "+img(ressEn[i])+"</td></tr>";
                        //
                        if(i < 2){// Avoid food and fiber
                            insideDiv += "<tr><td>"+img("worker")+" + "+img(objEn[i]+"-ore")+"/" + qnty[i][1] + "</td>\
                                <td><button onclick='gathering(\""+ressEn[i]+"\", 2, \"gather\")'";
                            if(!gathering(ressEn[i], 2, "cost")){insideDiv += " class=unclicable DISABLED";}
                            insideDiv += ">>>></button></td><td>+" + gathering(ressEn[i], 2, "gain") + " "+img(ressEn[i])+"</td></tr>";
                        }
                        insideDiv += "</table>";
                    }
                    document.getElementById('main_div').innerHTML = insideDiv;
                }
////////////////
                else if(witchDiv == "refine"){
                    witchMenu = "refine"; update("dashboard"); updateStat(player.localisation);
                    insideDiv = "<h1>Affinage</h1>" + tipDisplay("refine");

                    insideDiv += "<table class=clipboard><tr><th colspan=3>Planche</th></tr>";
                    insideDiv += "<tr><td>1 "+img("wood")+"</td><td>";
                    if(axe.durabilityAvailable > 0){//Progress bar
                        insideDiv += "<button style=\"width:100%\" onclick='axe.durabilityAvailable--; player.wood -= 1; player.plank += 2; update(\"ressources\"); update(\"refine\"); updateStat("+player.localisation+");'";
                        if(player.wood < 1){insideDiv += " class=unclicable DISABLED";}
                        insideDiv += "> "; for(i=0;i<axe.durabilityAvailable;i++){insideDiv+="> ";}
                    }else{//Price
                        insideDiv += "<button style=\"width:100%\" onclick='player.workerAvaible--;";
                        if(axe.quantityAvailable[0] > 0){insideDiv += "axe.quantityAvailable[0]--;";}//Use axe-wood first
                        else{insideDiv += "axe.quantityAvailable[1]--;";}
                        insideDiv += "axe.durabilityAvailable=3; player.wood -= 1; player.plank += 2; update(\"ressources\"); update(\"refine\"); updateStat("+player.localisation+");'";

                        if((axe.quantityAvailable[0] === 0 && axe.quantityAvailable[1] === 0) || player.workerAvaible === 0 || player.wood < 1){
                            insideDiv += " class=unclicable DISABLED"
                        }
                        insideDiv += "> ";
                        insideDiv += img("worker")+" + ";
                        if(axe.quantityAvailable[0] > 0){insideDiv += img("axe-wood");}
                        else{insideDiv += img("axe-ore");}
                        insideDiv += "/"+Math.max(axe.quantityAvailable[0], axe.quantityAvailable[1]);
                    }
                    insideDiv += "</button></td><td>2 "+img("plank")+"</td></tr>";

                for(i of ["saw", "saw-windmill"]){
                    insideDiv += "<tr><td>1 "+img("wood")+"</td><td>";
                    if(buildings.durabilityAvailable[buildings.name.indexOf(i)] > 0){//Progress bar
                        insideDiv += "<button style=\"width:100%\" onclick='buildings.durabilityAvailable[buildings.name.indexOf(\""+i+"\")] --; player.wood -= 1; player.plank += 4; update(\"ressources\"); update(\"refine\"); updateStat("+player.localisation+");'";
                        if(player.wood < 1){insideDiv += " class=unclicable DISABLED";}
                        insideDiv += "> "; for(j=0;j<buildings.durabilityAvailable[buildings.name.indexOf(i)];j++){insideDiv+="> ";}
                    }else{//Price
                        insideDiv += "<button style=\"width:100%\" onclick='player.workerAvaible --;";
                        insideDiv += "buildings.quantityAvailable[buildings.name.indexOf(\""+i+"\")] --;";
                        insideDiv += "buildings.durabilityAvailable[buildings.name.indexOf(\""+i+"\")]=buildings.durabilityMax[buildings.name.indexOf(\""+i+"\")]-1; player.wood -= 1; player.plank += 4; update(\"ressources\"); update(\"refine\"); updateStat("+player.localisation+");'";

                        if(buildings.quantityAvailable[buildings.name.indexOf(i)] === 0 || player.workerAvaible === 0 || player.wood < 1 || player.wood < 1){
                            insideDiv += " class=unclicable DISABLED"
                        }
                        insideDiv += "> ";
                        insideDiv += img("worker")+" + "+buildings.img(i)+"/"+buildings.quantityAvailable[buildings.name.indexOf(i)];
                    }
                    insideDiv += "</button></td><td>4 "+img("plank")+"</td></tr>";
                }
                    insideDiv += "</table>";
/////////////////////
                    insideDiv += "<table class=clipboard><tr><th colspan=3>Minerai</th></tr>";
                for(i of ["furnace", "furnace-windmill"]){
                    insideDiv += "<tr><td>1 "+img("stone")+"</td><td>";
                    if(buildings.durabilityAvailable[buildings.name.indexOf(i)] > 0){//Progress bar
                        insideDiv += "<button style=\"width:100%\" onclick='buildings.durabilityAvailable[buildings.name.indexOf(\""+i+"\")] --; player.stone -= 1;player.ore += ";
                        if(i === "furnace"){insideDiv += "1";}//output
                        else{insideDiv += "2";}
                        insideDiv += ";update(\"ressources\");update(\"refine\"); updateStat("+player.localisation+");'";
                        if(player.stone < 1){insideDiv += " class=unclicable DISABLED";}
                        insideDiv += "> "; for(j=0;j<buildings.durabilityAvailable[buildings.name.indexOf(i)];j++){insideDiv+="> ";}
                    }else{//Price
                        insideDiv += "<button style=\"width:100%\" onclick='player.workerAvaible--;";
                        insideDiv += "buildings.quantityAvailable[buildings.name.indexOf(\""+i+"\")] --;";
                        insideDiv += "buildings.durabilityAvailable[buildings.name.indexOf(\""+i+"\")]=buildings.durabilityMax[buildings.name.indexOf(\""+i+"\")]-1; player.wood -= 1; player.stone -= 1; player.ore += ";
                        if(i === "furnace"){insideDiv += "1";}//output
                        else{insideDiv += "2";}
                        insideDiv += "; update(\"ressources\"); update(\"refine\"); updateStat("+player.localisation+");'";

                        if(buildings.quantityAvailable[buildings.name.indexOf(i)] === 0 || player.workerAvaible === 0 || player.stone < 1 || player.wood < 1){
                            insideDiv += " class=unclicable DISABLED"
                        }
                        insideDiv += "> ";
                        insideDiv += img("worker")+" + 1 "+img("wood")+" + "+buildings.img(i)+"/"+buildings.quantityAvailable[buildings.name.indexOf(i)];
                    }
                    insideDiv += "</button></td><td>";
                    if(i === "furnace"){insideDiv += "1";}//output
                    else{insideDiv += "2";}
                    insideDiv += " "+img("ore")+"</td></tr>";
                }
                    insideDiv += "</table>";
/////////////////////
                    insideDiv += "<table class=clipboard><tr><th colspan=3>Voile</th></tr>";
                for(i of ["loom", "loom-windmill"]){
                    insideDiv += "<tr><td>8 "+img("fiber")+"</td><td>";
                    if(buildings.durabilityAvailable[buildings.name.indexOf(i)] > 0){//Progress bar
                        insideDiv += "<button style=\"width:100%\" onclick='buildings.durabilityAvailable[buildings.name.indexOf(\""+i+"\")] --; player.fiber -= 8; player.sail += 1; update(\"ressources\"); update(\"refine\"); updateStat("+player.localisation+");'";
                        if(player.fiber < 8){insideDiv += " class=unclicable DISABLED";}
                        insideDiv += "> "; for(j=0;j<buildings.durabilityAvailable[buildings.name.indexOf(i)];j++){insideDiv+="> ";}
                    }else{//Price
                        insideDiv += "<button style=\"width:100%\" onclick='player.workerAvaible --;";
                        insideDiv += "buildings.quantityAvailable[buildings.name.indexOf(\""+i+"\")] --;";
                        insideDiv += "buildings.durabilityAvailable[buildings.name.indexOf(\""+i+"\")]=buildings.durabilityMax[buildings.name.indexOf(\""+i+"\")]-1; player.fiber -= 8; player.sail += 1; update(\"ressources\"); update(\"refine\"); updateStat("+player.localisation+");'";

                        if(buildings.quantityAvailable[buildings.name.indexOf(i)] === 0 || player.workerAvaible === 0 || player.fiber < 8){
                            insideDiv += " class=unclicable DISABLED"
                        }
                        insideDiv += "> ";
                        insideDiv += img("worker")+" + "+buildings.img(i)+"/"+buildings.quantityAvailable[buildings.name.indexOf(i)];
                    }
                    insideDiv += "</button></td><td>1 "+img("sail")+"</td></tr>";
                }
                    insideDiv += "</table>";

                    document.getElementById('main_div').innerHTML = insideDiv;
                }
////////////////
                else if(witchDiv == "tools"){
                    witchMenu = "tools"; update("dashboard");
                    insideDiv = "<h1>Outillage</h1>" + tipDisplay("tools");

                    let ressNeed = ["1 "+img("plank")+" + 1 "+img("wood"), "1 "+img("plank")+" + 1 "+img("ore"), "1 "+img("plank")+" + 1 "+img("wood"), "1 "+img("plank")+" + 1 "+img("ore"), "3 "+img("plank")];
                    let payPrice = ["player.plank --;player.wood --;axe.add(0, \"total\");", "player.plank --; player.ore --; axe.add(1, \"total\");",
                    "player.plank --; player.wood --; pickaxe.add(0, \"total\");", "player.plank --; player.ore --; pickaxe.add(1, \"total\");", "player.plank -= 3;basket.add(0, \"total\");"];
                    let isRessNotAva = [player.plank < 1 || player.wood < 1, player.plank < 1 || player.ore < 1, player.plank < 1 || player.wood < 1, player.plank < 1 || player.ore < 1, player.plank < 3];
                    let toolCreated = [img("axe-wood"), img("axe-ore"), img("pickaxe-wood"), img("pickaxe-ore"), img("basket")];

                    for(i=0; i<5; i++){
                        if(i === 0){insideDiv += "<table class=clipboard><tr><th colspan=3>Hache</th></tr>";}
                        else if(i === 2){insideDiv += "<table class=clipboard><tr><th colspan=3>Pioche</th></tr>";}
                        else if(i === 4){insideDiv += "<table class=clipboard><tr><th colspan=3>Panier</th></tr>";}

                        insideDiv += "<tr><td>"+ressNeed[i]+"</td><td>";

                        if(buildings.durabilityAvailable[buildings.name.indexOf("toolstation")] > 0){//Progress bar
                            insideDiv += "<button onclick='buildings.durabilityAvailable[buildings.name.indexOf(\"toolstation\")] --;"+payPrice[i]+ "update(\"ressources\"); update(\"tools\");'";
                            if(isRessNotAva[i]){insideDiv += " class=unclicable DISABLED";}
                            insideDiv += "> "; for(j=0;j<buildings.durabilityAvailable[buildings.name.indexOf("toolstation")];j++){insideDiv+="> ";}
                        }else{//Price
                            insideDiv += "<button onclick='player.workerAvaible--;";
                            insideDiv += "buildings.quantityAvailable[buildings.name.indexOf(\"toolstation\")] --;";
                            insideDiv += "buildings.durabilityAvailable[buildings.name.indexOf(\"toolstation\")]=buildings.durabilityMax[buildings.name.indexOf(\"toolstation\")]-1;"+payPrice[i]+"update(\"ressources\");update(\"tools\");'";

                            if(buildings.quantityAvailable[buildings.name.indexOf("toolstation")] === 0 || player.workerAvaible === 0 || isRessNotAva[i]){
                                insideDiv += " class=unclicable DISABLED"
                            }
                            insideDiv += "> ";
                            insideDiv += img("worker")+" + "+buildings.img("toolstation")+"/"+buildings.quantityAvailable[buildings.name.indexOf("toolstation")];
                        }
                        insideDiv += "</button></td><td>"+toolCreated[i]+"</td></tr>";

                        if(i === 1 || i === 3 || i === 4){insideDiv += "</table>";}
                    }
                    document.getElementById('main_div').innerHTML = insideDiv;
                }
////////////////
                else if(witchDiv == "building"){
                    witchMenu = "building"; update("dashboard");
                    insideDiv = "<h1>Construction</h1>" + tipDisplay("building");

                    for(i=0; i<buildings.name.length; i++){
                        if(i===3){insideDiv += "<h1>Affinage +</h1>";}
                        else if(i===7){insideDiv += "<h1>Transport</h1>";}
                        else if(i===10){insideDiv += "<h1>Autre</h1>";}
                        insideDiv += "<p>"+buildings.img(i)+" <span style=\"font-size:2em\">"+buildings.nameFr[i]+"</span> <span style=\"cursor:help\" title='Disponible/Total'> "+buildings.quantityAvailable[i]+"/" +buildings.quantityTotal[i]+ "</span><br>"+buildings.description[i];
                        if(buildings.durabilityMax[i] > 0){insideDiv += "<br>Nombre d'utilisation par jour : "+buildings.durabilityMax[i];}
                        if(buildings.name[i] === "wagon" || buildings.name[i] === "wagon-large"){insideDiv += "<br>Poids : 0 " + img("weight");
                        }else{insideDiv += "<br>Poids : " + buildings.weight[i] + " " + img("weight");}
                        insideDiv += "<br>Coût : ";
                        insideDiv += buildings.price(i);
                        insideDiv += "<br>"+buildings.buildButton(i, "keepbook")+" <button onclick='player.bookmarked="+i+"; update(\"building\"); updateStat("+player.localisation+");' ";
                        if(player.bookmarked === i){insideDiv += "style=\"filter:hue-rotate(150deg)\"";}
                        insideDiv += ">"+img("bookmark")+"</button></p>";
                    }
                    document.getElementById('main_div').innerHTML = insideDiv;
                }
////////////////
                else if(witchDiv == "stock"){
                    witchMenu = "stock"; update("dashboard");
                    insideDiv = "<h1>Stock</h1>" + tipDisplay("stock");
                    insideDiv += stockManagement("stock");

                    document.getElementById('main_div').innerHTML = insideDiv;
                }
////////////////
                else if(witchDiv == "ressources"){
                    insideDiv = "<table><tr><td class=td_ress_left>"+ player.workerAvaible + "<span class=ressources_next_day>/" + player.workerTotal + "</span></td><td class=td_ress_right>"
                    +img("worker")+"</td><td class=td_ress_left>"+ player.wood;
                    if(player.woodNextDay > 0){insideDiv += "<span class=ressources_next_day style=\"cursor:help;\" title=\"Bois récolté dans la journée\">+"+ player.woodNextDay + "</span>";}
                    insideDiv += "</td><td class=td_ress_right>"+img("wood")+"</td><td class=td_ress_left>" + player.stone;
                    if(player.stoneNextDay > 0){insideDiv += "<span class=ressources_next_day style=\"cursor:help;\" title=\"Roche récoltée dans la journée\">+"+player.stoneNextDay + "</span>";}
                    insideDiv += "</td><td class=td_ress_right>"+img("stone")+"</td><td class=td_ress_left>"+ player.fiber;
                    if(player.fiberNextDay > 0){insideDiv += "<span class=ressources_next_day style=\"cursor:help;\" title=\"Fibre récoltée dans la journée\">+"+player.fiberNextDay + "</span>";}
                    insideDiv += "</td><td class=td_ress_right>"+img("fiber")+"</td><td class=td_ress_left>"+ player.food + "<span ";
                    if((player.foodNextDay+zepplin)-(player.workerTotal+player.wounded) >= 0){insideDiv += "class=ressources_next_day ";}
                    else{insideDiv += "class=warning ";}
                    insideDiv += "style=\"cursor:help;\" title=\"Nourriture consommée chaque soir par ceux qui te suivent\"> -" +player.workerTotal + "</span>";
                    if(player.foodNextDay === 0){insideDiv += "";}
                    else{insideDiv += "<span class=ressources_next_day style=\"cursor:help;\" title=\"Nourriture récoltée dans la journée\"> +"+ player.foodNextDay + "</span>";}
                    if(zepplin > 0){insideDiv += "<span class=ressources_next_day style=\"cursor:help;\" title=\"Nourriture par nassolfière\"> +" + zepplin + "</span>";}
                    insideDiv += "</td><td class=td_ress_right>"+img("food")+"</td>";
                    insideDiv += "<td>";
                    if(player.daysBeforeStorm === 0){insideDiv += "<span class=warning>L'heure du départ</span>";}
                    else if(player.daysBeforeStorm === 1){insideDiv += "<span class=warning>Dernier jour</span>";}
                    else{insideDiv += player.daysBeforeStorm;}
                    insideDiv += " "+img("time")+"</td></tr>";

                    insideDiv += "<tr><td class=td_ress_left>";
                    if(player.wounded === 0){insideDiv += "<span title=\"Nombre de blessés, ayant chaque soir trois chances sur quatre de se rétablir\" style=\"cursor:help\" class=ressources_next_day>" + player.wounded + "</span>";}
                    else{insideDiv += player.wounded;}
                    insideDiv += "</td><td class=td_ress_right>"+img("wounded")+"</td><td class=td_ress_left>"+ player.plank +"</td><td class=td_ress_right>"+img("plank")+"</td><td class=td_ress_left>"+ player.ore +"</td><td class=td_ress_right>"+img("ore")+"</td><td class=td_ress_left>"+ player.sail +"</td><td class=td_ress_right>"+img("sail")+"</td><td class=td_ress_left>";
                    player.weight = stockManagement("weightsum");
                    player.weightMax = -stockManagement("lightsum");
                    if(player.weight <= player.weightMax){insideDiv += player.weight +" / "+ player.weightMax;}
                    else{insideDiv += "<span class=warning>"+ player.weight +" / "+ player.weightMax +"</span>";}
                    insideDiv += "</td><td class=td_ress_right>"+img("weight")+"</td><td>";
                    //
                    if(howManyCredits("all") <= taxe[0]){
                        insideDiv += "<div class=progressbar title=\"Valeur actuelle/nécessaire pour payer la taxe de la forteresse des montagnes, calculée dans Stock\"><div style=\"width:"+parseInt(howManyCredits("all")*100/taxe[0])+"%;\">"+howManyCredits("all")+"/"+taxe[0]+"</div></div> ";
                    if(howManyCredits("all") === taxe[0]){insideDiv += img("taxe-base");}
                    else{insideDiv += "<span class=unclicable>"+img("taxe-base")+"</span>";}
                    }else{
                        if(howManyCredits("all") <= taxe[0]+taxe[1]){
                            insideDiv += img("taxe-base")+" <div class=progressbar title=\"Valeur actuelle/nécessaire pour pouvoir mener une vie paisible dans la forteresse des montagnes\"><div style=\"width:"+parseInt((howManyCredits("all")-taxe[0])*100/taxe[1])+"%;\">"+(howManyCredits("all")-taxe[0])+"/"+taxe[1]+"</div></div> ";
                            if(howManyCredits("all") === taxe[0]+taxe[1]){insideDiv += img("taxe-1st");}
                            else{insideDiv += "<span class=unclicable>"+img("taxe-1st")+"</span>";}
                        }else{
                            if(howManyCredits("all") <= taxe[0]+taxe[1]+taxe[2]){
                                insideDiv += img("taxe-base")+" "+img("taxe-1st")+" <div class=progressbar title=\"Valeur actuelle/nécessaire pour pouvoir mener une vie divine dans la forteresse des montagnes\"><div style=\"width:"+parseInt((howManyCredits("all")-taxe[0]-taxe[1])*100/taxe[2])+"%;\">"+(howManyCredits("all")-taxe[0]-taxe[1])+"/"+taxe[2]+"</div></div> ";
                                if(howManyCredits("all") === taxe[0]+taxe[1]+taxe[2]){insideDiv += img("taxe-2nd");}
                                else{insideDiv += "<span class=unclicable>"+img("taxe-2nd")+"</span>";}
                            }else{
                                insideDiv += img("taxe-base")+" "+img("taxe-1st")+" "+img("taxe-2nd")+" <div class=progressbar title=\"Surplus de ta future vie divine\"><div style=\"width:100%;\">+ "+(howManyCredits("all")-taxe[0]-taxe[1]-taxe[2])+"</div></div>";
                            }
                        }
                    }
                    //
                    insideDiv += "</td></tr></table>";
                    document.getElementById('ressources_div').innerHTML = insideDiv;
                }
////////////////
                else if(witchDiv == "night"){
                    witchMenu = ""; update("dashboard");
                    let rand;
                    let encounters = [[0,0,0,1,2,2,3,3], [0,1,1,2,2,3,3,3], [0,1,1,2,2,2,3,3]];//Balancing
                    if(board.spotJ[player.localisation] < 7){rand = encounters[0][parseInt(Math.random()*8)];}
                    else if(board.spotJ[player.localisation] < 13){rand = encounters[1][parseInt(Math.random()*8)];}
                    else{rand = encounters[2][parseInt(Math.random()*8)];}
                    let h1, back, button;
                    let noRessources = false;

                    if(rand === 0){//Nothing
                        let rng = parseInt(Math.random()*8);
                        h1 = "Nuit calme avant la tempête";
                        button = "<button onclick='player.needToChoose=false;update(\"map\");'>S'endormir</button>";
                        if(rng === 0){
                            back = "C’est à ton tour de <span class=important_txt>monter la garde</span>. Tu te couvres et tu vas te positionner à l’endroit le plus critique : face à la partie la plus ouverte du campement, face à l’immensité des steppes. Les "+definitionOf("tauran")+" brodent le ciel, apportant le peu de lumière disponible lors de l’absence d’"+definitionOf("ido")+". Le vent, le calme, les herbes hautes ondulant telles des vagues sont tous des éléments apaisants pour toi. Puis vient le moment de la ronde autour du camp, pour éloigner les bêtes et pour se réchauffer car les nuits sont fraîches. Après plusieurs passages à épier les alentours, c’est l’heure de retourner au feu pour l’entretenir et y terminer la nuit.";
                        }else if(rng === 1){
                            if(ocarina != "builded"){
                            back = "Vous êtes allés vite aujourd’hui, le "+definitionOf("rana")+" n’est pas trop bas à l’horizon. Tu en profites pour sortir de tes poches un morceau de bois d’un "+definitionOf("saxaoul rampant")+" que tu as récupéré en chemin. Le bois est très lisse, presque glissant au touché. Tu vas prendre quelques outils et t’installes non loin de l’atelier pour commencer à modeler le bois. Si au début tu ne penses à rien d’autre qu’à te détendre, très vite la forme d’un "+definitionOf("sarewa")+" semble se dessiner sous tes doigts, et tu accentues ainsi ces formes arrondies. Tu commences par t’occuper du résonateur, s’en suit le goulot, biseau, porte-vent pour finir par les trous : futurs emplacements de tes doigts.<br>Après le repas, tu reprends ton travail et commence à peine la gravure pour le décorer avant de tomber de fatigue.";
                            button = "<button onclick='player.needToChoose=false; update(\"dashboard\"); update(\"map\"); ocarina=\"builded\"'>S'endormir</button>";
                            }else{
                            back = "Fin de journée laborieuse, tu as bien cru à plusieurs reprises ne pas pouvoir y arriver avant que le "+definitionOf("rana")+" ne se couche. Enfin un peu de temps pour toi. Tu ressors alors le "+definitionOf("sarewa")+" terminé. Tu ajustes les notes et certains des tiens commencent à se regrouper timidement autour de toi.<br>À peine une heure s’est écoulée et c’est l’ensemble du camp qui est autour de toi à manger et chanter au son du "+definitionOf("sarewa")+".<br>Une petite tranche de bonheur… pour un soir.";
                            button = "<button onclick='player.needToChoose=false; update(\"dashboard\"); update(\"map\"); ocarina=\"played\"'>S'endormir</button>";
                            //TODO music
                            }
                        }else if(rng === 2){
                            back = "Aujourd’hui tout le monde a dû aider plus que d’accoutumé. Et tu leur en a demandé beaucoup, d’autant plus que c’était très physique. C’est pourquoi ce soir c’est <span class=important_txt>étirement et massage</span> pour tout le monde. Que ce soient les muscles des jambes qui ont piétiné le sol, ceux des bras qui ont tiré et transporté, ceux du dos qui se sont arc-boutés et contractés, tout doit y passer.<br>Ce n’est qu’après ces exercices que vous mangez, décontractés mais aussi épuisés avant de vous endormir lourdement d’un sommeil sans rêve.";
                        }else if(rng === 3){
                            if(sake != "builded"){
                            back = "Presque tout va pour le mieux en ce début de soirée. À bâbord on réfléchit à comment améliorer le campement, à tribord c’est comment fabriquer un engrenage… on se croirait presque dans un camp « découverte » organisé. Tout cet entrain et ce dynamisme à entreprendre te donnent envie de bricoler un objet pour le groupe. Un objet pour se retrouver ensemble à réfléchir, un "+definitionOf("sake")+". Tu fonces à l’atelier pour commencer la réalisation de ton idée avec les chutes de bois, et tu commences à tailler les différentes pièces.<br>Après quelques allés et retours aux abords éclairés du campement pour récupérer les dernières ressources nécessaires, tu termines la réalisation du "+definitionOf("sake")+" alors que les autres sont tous déjà endormis. Vous y jouerez lors d’une autre soirée.";
                            button = "<button onclick='player.needToChoose=false; update(\"dashboard\"); update(\"map\"); sake=\"builded\"'>S'endormir</button>";
                            }else{
                            back = "Ce soir, tu penses avoir le temps de jouer au "+definitionOf("sake")+". Tu sors tout fier les différents éléments de jeux que tu disposes non loin du feu, avant d’alpaguer ton futur adversaire.<br>Après plusieurs parties contre l’un puis l’autre, vous vous endormez tous, un souffle de bonne humeur se répandant sur le camp.";
                            button = "<button onclick='player.needToChoose=false; playSake(); sake=\"played\"'>Rêver des parties jouées</button> <button onclick='player.needToChoose=false;update(\"map\");'>S'endormir sans rêve</button>";
                            }
                        }else if(rng === 4){
                            back = "<span class=important_txt>Le souk, le bazar</span>. C’est ce que tu as sur les lèvres en voyant, à ton retour, l’organisation du campement. Des outils qui traînent, des voiles non ferlées, des copeaux de bois et des éclats de roche partout, et de la poussière. La décision est prise de ranger tout ça au plus vite. Pour commencer : atelier confection de balais à bâbord et ré-arrimage du chariot à voile à tribord et ensuite tout le monde nettoie le camp.<br>Ce n’est qu’après ce travail supplémentaire mais nécessaire que tu peux te dire que la journée est terminée.";
                        }else if(rng === 5){
                            back = "Allez ! Cela n’a que trop traîné ! Ce soir, tu inities une <span class=important_txt>réunion</span> officielle : tu veux les entendre et connaître leurs opinions à propos des erreurs que tu as pu commettre, quels sont leurs reproches, et surtout tu veux les questionner sur l’après "+definitionOf("tashi")+". Que veulent-ils ? Comment faire pour se reconstruire et repartir d’un nouveau souffle ?<br>La réunion fût grave mais nécessaire. La plupart ne te suivra plus après la forteresse des montagnes, si tant est que vous y arriviez. Ils ont tous beaucoup perdu et ont grandement mûri grâce à cette expérience. Tu aurais dit « vieillis ». Tu connaissais les risques encourus à rester lors de la "+definitionOf("farko kalama")+", n’est-ce pas, et malgré tout, tu leur as dit de garder le cap, de rester face au vent.<br>Cette réunion t’a toi même beaucoup ballottée en te faisant repenser une fois de plus à ces évènements. Et c’est le cœur lourd que tu pars t’endormir ce soir, un peu plus à l’écart des autres.";
                        }else if(rng === 6){
                            back = "À l’approche de la nuit tout le monde devient plus calme, les mouvements sont plus lents, les esprits plus embrumés. La petite troupe vient se blottir au coin du feu. C’est le moment idéal pour discuter, échanger et rappeler aux plus jeunes ce qui compose l’environnement qui les entoure, à commencer par les grands herbivores que certains ont vus de plus ou moins loin ces derniers jours.<br>Le maître des steppes c’est le <span class=important_txt>pottok hexapode à crête</span>. Un cheval assez large d’épaule dont la robe est souvent claire, beige roussie ou gris cendre. Les poils, mi-longs, deviennent couramment plus sombres au niveau des pattes. Ces dernières au nombres de six lui permettent de se déplacer à une vitesse fulgurante afin d’échapper à la "+definitionOf("panthère coloristrate")+", son principal prédateur. Cette espèce de pottok est caractérisée par la crête droite qu’il porte. Cet alignement de poils, souvent foncés, part du haut de son crâne jusqu’à la base de ses omoplates, puis diminue de trois quart de hauteur pour aller rejoindre sa queue.<br>Un autre grand herbivore emblématique des steppes, mais plus rare dans les environs : le <span class=important_txt>yack quadkern</span>. Comme son nom l’indique, c’est un yack dont la particularité est d’avoir quatre cornes. Les espèces de yack sont nommées en fonction du nombre ou de la forme de leurs cornes. Celui à quatre cornes est l’espèce la plus abondante des steppes et du début des plateaux montagneux. Bien plus imposant que le pottok, habituellement au moins quatre fois plus gros, le yack peut être amadoué pour servir de moyen de transport de personnes ou de chargements encombrants. Certains marchands des premiers plateaux en font des échoppes mobiles leur permettant de vendre leurs produits sans tout défaire. Ses poils peuvent être utilisés, notamment pour le cordage, meilleurs que les fibres du "+definitionOf("lin abrufil")+" que vous trouvez en ce moment, mais pour les voiles il est préférable d’utiliser le poil des bouquetins vapolaines.<br>Ces derniers, vous les connaissez mieux car des membres de la "+definitionOf("kabila")+" en avaient élevés. Le <span class=important_txt>bouquetin vapolaine</span> est assez rare à l’état sauvage mais cependant extrêmement symbolique des steppes car c’est grâce à sa laine particulièrement vaporeuse que les voiles des "+definitionOf("zuriya mayafi")+" sont tissées, leur conférant légèreté et résistance. Les bouquetins sont friands d’une fleur leur donnant la langue bleue. Cette fleur, une centaurée, était tout le temps broutée par l’animal si bien qu’on la nomma <span class=important_txt>centaurée sans-tête</span>. N’essayez pas de la manger car si vous avez la chance de trouver la fleur de cette plante, l’histoire raconte qu’en plus de la langue bleue, votre pilosité pourrait s’en voir augmenter très fortement.<br>Sur ces paroles ayant fait rire tout le monde, tu proposes à ceux qui t’entourent d’aller se reposer car le lendemain ne sera pas une partie de plaisir.";
                        }else if(rng === 7){
                            back = "Le vol de "+definitionOf("grues à ailerons")+" marque la fin de cette journée, et te donne l’occasion de parler une fois de plus de la faune qui vous entoure. En parlant d’oiseaux, le plus connu des steppes est sans aucun doute le <span class=important_txt>busard casquorne</span>. Comme vous le savez, ce rapace a sur la tête comme un casque à cornes, celles-ci pointant vers l’arrière de son corps. Tout le monde étant au courant de sa morphologie et de sa symbolique, il convient donc d’être plus précis sur d’autres aspects de l’animal tel que son régime alimentaire. Sa principale source de nourriture est les rongeurs, et parmi les plus abondants se retrouvent la "+definitionOf("gerboise à groin")+" et la "+definitionOf("marmotte quadrops")+". Même si cette dernière est plus difficile à attraper pour lui et qu’elle est également prédatée par le "+definitionOf("renard déonvert")+", le busard se bat pour cette chaire plus douce et plus grosse que de simples gerboises.<br>Ces dernières, de ce fait plus abondantes, font généralement leur terrier sous des buissons. Cela leur permet d’obtenir une protection des voies aériennes, de l’ombrage lors des périodes d’ensoleillement et un garde-manger notamment lorsque ces buissons sont en fleurs. Les insectes ainsi attirés font la joie des gerboises à groin qui peuvent ainsi se délecter sans bouger d’espèces comme le "+definitionOf("papillon goutte")+", au lieu de se déplacer chasser la "+definitionOf("sauterelle milong")+".<br>Alors que tu allais ajouter une précision sur l’importance des papillons pour la pollinisation et leur lien avec les "+definitionOf("iris poilrosette")+", tu remarques que les ventres gargouillent et que quelques filets de bave coulent sous les masques à force d’avoir parlé de nourriture. Tu dévies subtilement la conversation pour la porter sur la nuit, puis te lèves et annonces que c’est le moment d’aller dormir : la soirée est déjà bien avancée. Quelques uns grognent un peu, est-ce ta décision ou le souvenir d’avoir peu mangé ? Mais tout le monde fini par partir se trouver un endroit où s’allonger.";
                        }else{update("night");}
/////////////////////
                    }else if(rand === 1){//Ressources lost
                        h1 = "Dépense de ";
                        let ress = "";
                        let nb;
                        let flipCoin = parseInt(Math.random()*2)//rope or not
                        let rng = parseInt(Math.random()*7);//nb ressources
                        if(flipCoin === 0){
                            if(rng === 0){//wood
                                h1 += "bois";
                                back = "La journée a été très ensoleillée, mais également très venteuse. Aucun nuage n’est resté au dessus de vos têtes. Et donc, tout naturellement, la chaleur du "+definitionOf("rana")+" ne s’est pas accumulée, c’est pourquoi <span class=important_txt>il fait froid ce soir</span>, très froid. Pour éviter que certains ne tombent malades, tu décides de rajouter quelques bûches au feu de camp.";
                                if(player.wood === 0){
                                    back += " Mais en allant en chercher tu te rends compte que vous n'en avez plus.";
                                    button = "<button onclick='player.needToChoose=false; player.workerAvaible --; player.wounded ++; update(\"map\"); update(\"ressources\");'>+1 "+img("wounded")+"</button>";
                                }else{
                                    let nbr;
                                    if(player.wood > 2){nbr = 2;}
                                    else{nbr = player.wood;}
                                    button = "<button onclick='player.needToChoose=false; player.wood -= "+nbr+"; update(\"map\"); update(\"ressources\");'>-"+nbr+" "+img("wood")+"</button>";
                                }
                            }else if(rng === 1){//plank
                                h1 += "planches";
                                ress = "plank";
                                let onOneSide = parseInt(Math.random()*2);
                                if(onOneSide === 0 && player.plank >= 3){
                                    back = "Ce n’est pas la première fois que l’on vient te voir concernant le <span class=important_txt>confort du campement</span>. Les premières fois, tu les avais envoyés galérer, ils pensent être en promenade de santé, mais ce soir ils se montrent plus insistants. Tu réfléchis plus en profondeur sur les bénéfices que cela pourrait avoir, au moins sur ceux là. Après quelques secondes tu décides d’accéder à leur requête et tu les aides même à améliorer le campement.";
                                    nb = 3;
                                    if(player.plank >= 4){nb = 4;}
                                }else if(onOneSide === 1 && player.plank >= 5){
                                    back = "Si tu avais espéré avoir du temps pour te reposer, ce n’est pas pour ce soir. Le "+definitionOf("zuriya mayafi")+" a besoin de réparation. Vous vous mettez à plusieurs et entreprenez ce carénage. Cela prend du temps et de l’énergie, d’autant plus que tu n’as pas récupéré beaucoup d’outils au port. Vous devez donc faire avec les moyens du bord, et cela demande également beaucoup de planches.";
                                    nb = 5;
                                    if(player.plank >= 6){nb = 6;}
                                }else{noRessources = true;}
                            }else if(rng === 2){//ore
                                h1 += "minerais";
                                ress = "ore";
                                let onOneSide = parseInt(Math.random()*2);
                                if(onOneSide === 0 && player.ore >= 1){
                                    back = "Pour être efficace dans ce que vous faites au quotidien, vous devez vous équiper. Pour chaque construction, vous fabriquez seulement les <span class=important_txt>outils nécessaires</span> par manque de temps. Mais ce soir, tu décides que pour plus d’efficacité pour la suite du "+definitionOf("tashi")+" vous allez en concevoir un ou deux de plus.";
                                    nb = 1;
                                    if(player.ore >= 2){nb = 2;}
                                }else if(onOneSide === 1 && player.ore >= 2){
                                    back = "La hache a failli lâcher aujourd’hui. Tu te rends compte qu’il faut absolument que vous vous occupiez de <span class=important_txt>remplacer les pièces de métal</span> abîmées avant qu’elles ne cèdent. Tu as besoin de le faire sur quelques outils mais également sur les structures que vous renforcez pour les rendre plus solides.";
                                    nb = 2;
                                    if(player.ore >= 3){nb = 3;}
                                }else{noRessources = true;}
                            }else if(rng === 3){//fiber
                                h1 += "fibres";
                                ress = "fiber";
                                let onOneSide = parseInt(Math.random()*2);
                                if(onOneSide === 0 && player.fiber >= 8){
                                    back = "La nuit dernière fût particulièrement terrible pour ton dos. À force de dormir quasiment à même le sol et de solliciter ton dos la journée, celui-ci est dans un sale état. Ce qu’il vous faut ce sont des <span class=important_txt>matelas</span> ! Tu récupères les quelques fibres qui traînent pour les emmailloter et ainsi former des paillasses rudimentaires.";
                                    nb = 8;
                                    if(player.fiber >= 12){nb = 12;}
                                    else if(player.fiber >= 10){nb = 10;}
                                }else if(onOneSide === 1 && player.fiber >= 5){
                                    back = "Quand tu rentres le soir au campement, tu vois d’assez loin une voile faseyer au vent : l’écoute qui la retenait a dû lâcher. Arrivé sur place, tu affales toutes les voiles pour plus facilement avoir accès aux cordages et entames une soirée <span class=important_txt>épissage</span> pour éviter que cet évènement ne se reproduise.";
                                    nb = 5;
                                    if(player.fiber >= 6){nb = 6;}
                                }else{noRessources = true;}
                            }else if(rng === 4){//sail
                                h1 += "voiles";
                                ress = "sail";
                                let onOneSide = parseInt(Math.random()*2);
                                if(onOneSide === 0 && player.sail >= 2){
                                    back = "Avec la "+definitionOf("guguwa")+" qui arrive, les insectes nocturnes qui ne peuvent pas s’enterrer sont nombreux à voler au ras du sol pour s’en éloigner. La preuve en est : un flot incessant de "+definitionOf("sauterelle milong")+" a traversé le campement la nuit précédente. En ce début de soirée, tu prends donc les choses en main et décides de dédier quelques voiles à la confection d’une <span class=important_txt>tente</span> pour mieux dormir.";
                                    nb = 2;
                                    if(player.sail >= 3){nb = 3;}
                                }else if(onOneSide === 1 && player.sail >= 1){
                                    back = "Peu de temps après que le "+definitionOf("rana")+" se soit couché, le camp est frappé par gros coup de vent. Le changement brutal de température a entraîné ce flux d’air violent. Si violent que <span class=important_txt>des voiles se sont déchirées</span>. Vous affalez ces dernières et prenez de nouveaux morceaux de toiles : il faut recoudre et renforcer l’existant tout en essayant de ne pas trop alourdir la structure.";
                                    nb = 1;
                                    if(player.sail >= 2){nb = 2;}
                                }else{noRessources = true;}
                            }else if(rng === 5){//food
                                h1 += "nourriture";
                                ress = "food";
                                if(player.food >= 3){
                                    back = "Pour remonter le moral de ceux qui t’entourent et leur redonner de la force pour les jours qui arrivent, tu annonces une soirée que l’on aurait pu qualifier de festive en d’autres circonstances. Ainsi, tu augmentes, un peu, la <span class=important_txt>dose de nourriture</span> pour chacun. Les visages se détendent, un peu, et les conversations sont plus enjouées. Pour cette soirée au moins.";
                                    nb = 3;
                                    if(player.food >= 4){nb = 4;}
                                }else{noRessources = true;}
                            }else if(rng === 6){//worker
                                h1 += "main d'œuvre";
                                let sideOfHurt = parseInt(Math.random()*3);
                                if(player.wounded < player.workerTotal){
                                    back = "Après une journée épuisante à tout organiser, à pousser les organismes à bout et faire en sorte que tout soit fait rapidement, vient l’heure de se retrouver au calme autour du repas. Et ce n’est qu’à ce moment là, alors que tout le monde s’installe, que tu remarques que l’un d’eux s’est improvisé un <span class=important_txt>bandage</span> au niveau ";
                                    if(sideOfHurt === 0){back += "du torse";}
                                    else if(sideOfHurt === 1){back += "de la jambe droite";}
                                    else{back += "du bras gauche";}
                                    back += ".<br>Tu l’incites à se reposer de ses blessures et lui imposes de se ménager le lendemain.";
                                    button = "<button onclick='player.needToChoose=false; update(\"dashboard\"); player.workerAvaible -= 1; player.wounded += 1; update(\"map\"); update(\"ressources\");'>+1 "+img("wounded")+"</button>";
                                }else{noRessources = true;}
                            }else{noRessources = true;}
                        }else{//flipCoin === 1
                            let randomQnty = parseInt(Math.random()*3)+3;//Balancing
                            if(rng === 0){
                                h1 += "bois"; ressPlayer = "wood";
                                randomQnty = Math.min(player.wood, randomQnty);
                            }else if(rng === 1){
                                h1 += "planche"; ressPlayer = "plank";
                                randomQnty = Math.min(player.plank, randomQnty);
                            }else if(rng === 2){
                                h1 += "roche"; ressPlayer = "stone";
                                randomQnty = Math.min(player.stone, randomQnty);
                            }else if(rng === 3){
                                h1 += "métal"; ressPlayer = "ore";
                                randomQnty = Math.min(player.ore, randomQnty);
                            }else if(rng === 4){
                                h1 += "fibre"; ressPlayer = "fiber";
                                randomQnty = Math.min(player.fiber, randomQnty);
                            }else if(rng === 5){
                                h1 += "voile"; ressPlayer = "sail";
                                randomQnty = Math.min(player.sail, randomQnty);
                            }else if(rng === 6){
                                h1 += "nourriture"; ressPlayer = "food";
                                randomQnty = Math.min(player.food, randomQnty);
                            }
                            let addDisabled = [];
                            back = "Une fois de plus <span class=important_txt>le vent a soufflé</span> toute la journée, s’en était épuisant et pas du tout agréable comme à l’accoutumé. Et comme tout le monde était occupé, personne n’a fait attention aux stocks de ressources que le vent soulevait.<br>";
                            if(buildings.quantityTotal[buildings.name.indexOf("fortification")] > 0){
                                back += "Ta fortification atténuant cette perte.<br>";
                                randomQnty --;
                            }
                            if(buildings.quantityTotal[buildings.name.indexOf("rope")] > 0 && randomQnty > 0){
                                back += "Heureusement il y avait le "+buildings.nameFr[buildings.name.indexOf("rope")]+" pour tout retenir, même si il s’en est retrouvé abîmé.";
                                addDisabled[0] = ""; addDisabled[1] = "class=unclicable DISABLED";
                            }else if(randomQnty === 0){
                                back += "Heureusement le vent n'a pas été assez fort pour vous faire perdre quoi que ce soit.";
                                addDisabled[0] = "class=unclicable DISABLED"; addDisabled[1] = "";
                            }else{
                                back += "Malheureusement, une partie du stock s’est envolé avec le vent.";
                                addDisabled[0] = "class=unclicable DISABLED"; addDisabled[1] = "";
                            }
                            button = "<button onclick='player.needToChoose=false; buildings.quantityAvailable[buildings.name.indexOf(\"rope\")] -= 1; buildings.quantityTotal[buildings.name.indexOf(\"rope\")] -= 1; update(\"map\"); update(\"ressources\");' "+addDisabled[0]+">-1 "+buildings.img("rope")+"</button> <button onclick='player.needToChoose=false; player."+ressPlayer+" -= "+randomQnty+"; if(player."+ressPlayer+" < 0){player."+ressPlayer+" = 0;}; update(\"ressources\"); update(\"map\");' "+addDisabled[1]+">";

                            if(randomQnty > 0){
                                button += "-"+randomQnty+" "+img(ressPlayer);//display
                            }else{
                                button += "Aucune perte";
                            }
                            button += "</button>";
                        }
                        h1 += "... inéluctable ?";
                        if(ress != ""){button = "<button onclick='player.needToChoose=false; player."+ress+" -= "+nb+"; update(\"map\"); update(\"ressources\");'>-"+nb+" "+img(ress)+"</button>";}
/////////////////////
                    }else if(rand === 2){//Other events
                        let rng = parseInt(Math.random()*(7+1+buildings.quantityTotal[buildings.name.indexOf("beacon")]));//Balancing
                        if(rng === 0){
                            h1 = "Rencontre animale";
                            let randomCreature = parseInt(Math.random()*2);
                            let creature = [["doki", "cheetah"],
                            ["update(\"Tu t’approches de l’endroit et aperçoit un <span class=definition_txt title=cheval>pottok hexapode à crête</span>, la tête dans les fruits et légumes. Tu le chasses par de grands gestes et en faisant du bruit afin d’éviter ainsi qu’il se repaisse de vos maigres réserves.\");",
                            "update(\"Tu renvois la personne en lui ordonnant de chasser la bête.<br>Après quelques instants, tu entends un cri et vois ton chasseur revenir le bras ensanglanté. Il raconte tremblant que le genre de guépard lui est tombé dessus. Ses yeux lancent des éclairs à ton égard. Le pauvre devra se reposer demain.<br>+1 <img src=images/ressources/wounded.png title=Blessé width=32px>\"); player.workerAvaible --; player.wounded ++;"],
                            ["update(\"Le doki en profite donc pour manger une partie de votre stock de fruits et légumes.\"); player.food -= 6; if(player.food < 0){player.food = 0};",
                            "update(\"Le cheetah n’est pas intéressé par les fruits et légumes et s’en va en émettant quelques grognements.\");"]];
                            back = "Une journée bruyante qui se finit enfin, après quelques désaccords et tensions au sein du groupe. Alors que le repas se déroulait dans le calme, un des tiens arrive à grands pas pour te rapporter qu’un <span class=important_txt>"+creature[0][randomCreature]+"</span> a été aperçu non loin du stock de fruits et légumes.<br>Que préconises-tu ?";
                            button = "<button onclick='player.needToChoose=false;"+creature[1][randomCreature]+"update(\"ressources\"); update(\"dashboard\");'>S'approcher pour le chasser</button> <button onclick='player.needToChoose=false;"+creature[2][randomCreature]+"update(\"ressources\"); update(\"dashboard\");'>S'éloigner de l'endroit</button>";
                        }else if(rng === 1 && buildings.quantityTotal[buildings.name.indexOf("trap")] > 0){
                            let randomCreature = parseInt(Math.random()*5);//more chance to catch rabbit
                            let creatureFood;
                            let creatureFiber = 0;
                            h1 = "C'est un piège";
                            back = "Des piaillements de joie montent du campement. Un groupe s’est formé autour d’un des tiens qui brandit avec ferveur un ";
                            if(randomCreature === 0){back += definitionOf("sanglier dorsoplaque"); creatureFood = 6;}
                            else if(randomCreature === 1){back += definitionOf("bouquetin vapolaine"); creatureFood = 4; creatureFiber = 6;}
                            else{back += definitionOf("lièvre étoilé"); creatureFood = 2;}
                            back += ". Le piège que vous aviez installé semble avoir porté ses fruits. On t’explique cependant que l’animal, en se débattant, a brisé le piège. Il serait intéressant d’en faire un nouveau.";
                            button = "<button onclick='player.needToChoose = false; player.food += "+creatureFood+"; player.fiber += "+creatureFiber+"; buildings.quantityAvailable[buildings.name.indexOf(\"trap\")] --; buildings.quantityTotal[buildings.name.indexOf(\"trap\")] --; update(\"ressources\"); update(\"map\");'>-1 "+buildings.img("trap")+" +"+creatureFood+" "+img("food");
                            if(creatureFiber > 0){button += " +"+creatureFiber+" "+img("fiber");}
                            button += "</button>";
                        }else if(rng === 2){
                            h1 = "Pris au piège";
                            back = "Des cris te parviennent du campement. Tu y cours en ouvrant grands les yeux pour essayer de discerner où tu poses les pieds en cette nuit sans "+definitionOf("ido")+".<br>En approchant du lieu, tu entends également les grognements étouffés d’un ";
                            let randomCreature = parseInt(Math.random()*2);
                            if(randomCreature === 0){back += definitionOf("sanglier dorsoplaque")+".<br>";}
                            else{back += definitionOf("longmuseau à crinière")+".<br>";}
                            if(buildings.quantityTotal[buildings.name.indexOf("trap")] > 0){
                                back += "Par précaution, tu avais installé un piège et il s’est pris dedans, limitant ainsi les dégâts qu’auraient pu causer l’animal à votre campement. ";
                                if(randomCreature === 0){
                                    back += "Ce sanglier fera parfaitement office de repas ce soir !";
                                    let randomise = parseInt(Math.random()*2)+4;
                                    button = "<button onclick='player.needToChoose=false; buildings.quantityTotal[buildings.name.indexOf(\"trap\")] --; player.food += "+randomise+"; update(\"ressources\"); update(\"map\");'>-1 "+buildings.img("trap")+" +"+randomise+" "+img("food")+"</button>";
                                }else{
                                    back += "Tu le libères dans la nuit, et le chasses d’un coup au sol sec et bruyant.";
                                    button = "<button onclick='player.needToChoose=false; buildings.quantityTotal[buildings.name.indexOf(\"trap\")] --; update(\"ressources\"); update(\"map\");'>-1 "+buildings.img("trap")+"</button>";
                                }
                            }else{
                                back += "Tu n’avais pas prévu ça. Sans piège pour le retenir, il blesse <span class=important_txt>";
                                let randomise = parseInt(Math.random()*2)+1;
                                randomise = Math.min(randomise, player.workerAvaible);
                                back += randomise+" personne";
                                if(randomise >= 2){back += "s";}
                                back += "</span> avant de réussir à trouver un chemin pour s’enfuir dans les herbes hautes.<br>C’est sûrement le retour de bâton de vous être installés ici.";
                                button = "<button onclick='player.needToChoose=false; player.workerAvaible -= "+randomise+"; player.wounded += "+randomise+"; update(\"ressources\"); update(\"map\");'>+"+randomise+" "+img("wounded")+"</button>";
                            }
                        }else if(rng === 3){
                            h1 = "Trouvailles";
                            back = "Après avoir fait le nécessaire sur le camp, tu passes une petite partie de la journée à explorer les environs. Ce n’est pas la première fois que tu pars vagabonder, ça te fait penser à autre chose et tu espères toujours ne pas revenir bredouille. Ce soir ta persévérance a été récompensée car tu trouves <span class=important_txt>";
                            let randomBuild = parseInt(Math.random()*4);//More camp
                            if(randomBuild === 0){back += "un moulin isolé";}
                            else if(randomBuild === 1){back += "la carcasse d’un navire";}
                            else{back += "le reste d'un campement";}
                            back += "</span>.<br>Après une fouille approfondie de ces décombres, tu arrives à extraire et ramener au campement avant que tout ne s’écroule et s’éparpille :<br>";
                            back += "> ce que tu as inventorier à l'<span class=important_txt>est</span> :<br>";
                            let rngRess = [];
                            for(i=0; i<7; i++){rngRess[i] = parseInt(Math.random()*3);}//Balancing
                            if(rngRess[0] > 0){back += " +"+rngRess[0]+" "+img("wood");}
                            if(rngRess[1] > 0){back += " +"+rngRess[1]+" "+img("plank");}
                            if(rngRess[2] > 0){back += " +"+rngRess[2]+" "+img("stone");}
                            if(rngRess[3] > 0){back += " +"+rngRess[3]+" "+img("ore");}
                            if(rngRess[4] > 0){back += " +"+rngRess[4]+" "+img("fiber");}
                            if(rngRess[5] > 0){back += " +"+rngRess[5]+" "+img("sail");}
                            if(rngRess[6] > 0){back += " +"+rngRess[6]+" "+img("food");}
                            back += "<br>> ce que tu as inventorier à l'<span class=important_txt>ouest</span> :<br>";
                            let rngRessources = [];
                            for(i=0; i<7; i++){rngRessources[i] = parseInt(Math.random()*3);}//Balancing
                            if(rngRessources[0] > 0){back += " +"+rngRessources[0]+" "+img("wood");}
                            if(rngRessources[1] > 0){back += " +"+rngRessources[1]+" "+img("plank");}
                            if(rngRessources[2] > 0){back += " +"+rngRessources[2]+" "+img("stone");}
                            if(rngRessources[3] > 0){back += " +"+rngRessources[3]+" "+img("ore");}
                            if(rngRessources[4] > 0){back += " +"+rngRessources[4]+" "+img("fiber");}
                            if(rngRessources[5] > 0){back += " +"+rngRessources[5]+" "+img("sail");}
                            if(rngRessources[6] > 0){back += " +"+rngRessources[6]+" "+img("food");}
                            button = "<button onclick='player.needToChoose=false; player.wood += "+rngRess[0]+"; player.plank += "+rngRess[1]+"; player.stone += "+rngRess[2]+"; player.ore += "+rngRess[3]+"; player.fiber += "+rngRess[4]+"; player.sail += "+rngRess[5]+"; player.food += "+rngRess[6]+"; update(\"ressources\"); update(\"map\");'>À l'est</button> ";
                            button += "<button onclick='player.needToChoose=false; player.wood += "+rngRessources[0]+"; player.plank += "+rngRessources[1]+"; player.stone += "+rngRessources[2]+"; player.ore += "+rngRessources[3]+"; player.fiber += "+rngRessources[4]+"; player.sail += "+rngRessources[5]+"; player.food += "+rngRessources[6]+"; update(\"ressources\"); update(\"map\");'>À l'ouest</button>";
                        }else if(rng === 4 && player.wood === 0){
                            h1 = "Pas de bois, pas de feu, pas de feu...";
                            back = "Le nuit est noire et l’absence de feu faute de bois n’aide en rien.<br>C’est dans un stress palpable que tu passes la nuit ou du moins l’entames. En effet, il n’aura pas fallu longtemps avant de voir l’un des tiens affecté au renforcement de la surveillance nocturne revenir vers le camp après s’être fait agressé par une créature de la nuit. Il arrive tant bien que mal à s’en sortir mais ne sera pas apte à quoi que ce soit demain.<br>Vous vous resserrez les uns contre les autres et passez une fin de nuit affreuse, emplie de cauchemars.";
                            button = "<button onclick='player.needToChoose=false; player.workerAvaible --; player.wounded ++; update(\"ressources\"); update(\"map\");'>+1 "+img("wounded")+"</button>";
                        }else if(rng === 5){
                            h1 = "Une nouvelle source de nourriture";
                            back = "L’un des tiens tarde à rentrer tandis que les ombres s’allongent sur le campement. Alors que tu commences à préparer en vitesse une expédition pour aller enquêter, vous le voyez arriver, grand sourire, un panier rempli à ras bord de baies. Il claironne qu’il y en a plein non loin et semble très fier d’avoir découvert une nouvelle source de nourriture.<br>Avant que quiconque ne goûte à ces baies, tu les observes. Ce sont les baies du <span class=important_txt>buisson ";
                            let randomRessource = parseInt(Math.random()*2);
                            let addButton = "update(\"Elles sont comestibles, tu les reconnais et leur goût est sans pareil. Tu en manges une petite poignée avant d’inciter tout le monde à les cuisiner pour le dessert.<br>À l’heure du dessert, pour une fois qu’il y en a un, quelques uns s’en donnent à cœur joie et projettent de finir le panier, alors que d’autres hésitent.<br>";
                            if(randomRessource === 0){
                                back += "mutu";
                                addButton += "Ils ont bien fait car ce buisson n’est pas celui que tu croyais. <span class=important_txt>Les baies mutu sont toxiques</span> et tous les gourmands passeront la nuit et le lendemain avec des crampes au ventre.<br>+";
                                let randomMeeting = parseInt(player.workerAvaible/2);
                                addButton += randomMeeting+" <img src=images/ressources/wounded.png title=Blessé width=32px>\"); player.workerAvaible -= "+randomMeeting+"; player.wounded += "+randomMeeting+";";
                            }else{
                                back += "rayuwa";
                                addButton += "Dommage d’être si méfiant car <span class=important_txt>les baies rayuwa sont délicieuses</span>.<br>+";
                                let randomMeeting = parseInt(Math.random()*2)+6;
                                addButton += randomMeeting+" <img src=images/ressources/food.png title=Nourriture width=32px>\"); player.food += "+randomMeeting+";";
                            }
                            button = "<button onclick='player.needToChoose=false; update(\"dashboard\"); "+addButton+" update(\"ressources\");'>Les manger, elles sont comestibles</button> <button onclick='player.needToChoose=false; update(\"dashboard\"); update(\"Sans être vraiment sûr de toi tu décides de jeter l’ensemble du panier et tu interdis à quiconque de s’approcher du buisson.\");'>Les jeter, elles sont toxiques</button>";
                            back += "</span>.<br>Que faire ?";
                        }else{
                            let randomMeeting = parseInt(Math.random()*3);//Balancing ?
                            h1 = "Voile à l'horizon";
                            back = "En levant la tête pour observer le coucher du "+definitionOf("rana")+", tu plisses les yeux d’inquiétude en discernant des voiles à l’horizon. Ami ? Ennemi ? En tout cas elles se dirigent vers le campement. C’est sûr, ils vous ont vu";
                            if(buildings.quantityTotal[buildings.name.indexOf("beacon")] > 0){back += " sûrement à cause du mât roseau";}
                            back += " !<br>Tu affales en vitesse les voiles, couvre le feu alors que tout le monde adopte un positionnement défensif : plus ou moins cachés un outil à la main";
                            if(buildings.quantityTotal[buildings.name.indexOf("crossbow")] > 1){back += ", derrière les cranequins tripode";}
                            else if(buildings.quantityTotal[buildings.name.indexOf("crossbow")] > 0){back += ", derrière le cranequin tripode";}
                            if(buildings.quantityTotal[buildings.name.indexOf("fortification")] > 1){back += ", derrière les fortifications temporaires";}
                            else if(buildings.quantityTotal[buildings.name.indexOf("fortification")] > 0){back += ", derrière la fortification temporaire";}
                            back += ".<br>Après de longues minutes d’attente dans le silence, les voiles arrivent aux abords du campement : <span class=important_txt>";
                            if(randomMeeting === 0){
                                back += "un allié";
                                button = "<button onclick='player.needToChoose = false; update(\"dashboard\"); ally();'>Accueillir</button>";
                            }else if(randomMeeting === 1){
                                back += "un marchand";
                                button = "<button onclick='player.needToChoose = true; update(\"dashboard\"); merchandise();'>Marchander</button>";
                            }else{
                                back += "des pirates";
                                button = "<button onclick='player.needToChoose = false; update(\"dashboard\"); fight();'>Attaquer</button>";
                            }
                            back += "</span> !";
                        }
/////////////////////
                    }else{//Choices
                        let rng = parseInt(Math.random()*9);
                        let pGU = "player.needToChoose=false; update(\"dashboard\"); update(\"ressources\"); updateStat("+player.localisation+");"; //plusGenericUpdates
                        let dmgCo;
                        function calcDmgCo(nbW, percent){
                            dmgCo = 0;
                            for(i=0; i<nbW; i++){
                                if(Math.random() < percent){dmgCo ++;}
                            }
                        }
                        if(rng === 0 && player.sail > 0){
                            h1 = "Pêcher dans le ciel ?";
                            back = "Durant la journée, tu as entendu bourdonner et crépiter un essaim d’"+definitionOf("idoflames bariolés")+" non loin de ta zone d’activité. Tu soumets ce soir l’idée qui t’as traversée la tête à ce moment là : en capturer quelques uns pour fabriquer une "+definitionOf("nassolfière")+" et ainsi récolter aisément du gibier volant pour le reste de la traversée.<br>C’est une idée <span class=risk_percentage title=\"trois chances sur quatre d’être blessés\">très risquée</span> que d’attraper ces insectes et de les manipuler pour en extraire leur gaz. C’est pourquoi certains autour de toi s’écartent, réticents.<br>Souhaites-tu malgré tout les convaincre en prenant le risque de les blesser, et de dépenser l’<span class=important_txt>entièreté de vos voiles ";
                            if(player.fiber > 0){back += "et fibres ";}
                            back += "</span>pour accomplir ton objectif ? Ou souhaites-tu être prudent et ne pas entreprendre cette action dangereuse ?";
                            calcDmgCo(player.workerAvaible, 0.75);
                            button = "<button onclick='"+pGU+" update(\"Pour éviter que les tiens ne se brûlent en manipulant le feu avec ces insectes, tu vas en leur sens et acceptes leurs arguments. Il faudra cependant être plus efficace lors des récoltes de baies et de racines comestibles lors des prochaines journées pour subvenir à vos besoins alimentaires.\");'>Prudence</button> ";
                            button += "<button onclick='zepplin += player.sail; player.fiber=0; player.sail=0; player.workerAvaible -= "+dmgCo+"; player.wounded += "+dmgCo+"; "+pGU+" update(\"Après avoir insisté un peu plus et avoir clairement démontré la nécessité de ces pièges célestes, le groupe se joint à toi pour la chasse aux idoflames.<br>Malgré de nombreuses mésaventures, vous arrivez ensemble à en attraper et à extraire le précieux gaz. Les rares doigts non brûlés réussissent, avant le début de cette nouvelle journée, à coudre ";
                            if(player.sail >= 2){button += "quelques voiles entre elles pour former les ballons.";}
                            else{button += "et plier la voile sur elle même pour former le ballon.";}
                            button += "<br>Bilan de la journée : <span class=important_txt>";
                            if(dmgCo >= 2){button += dmgCo + " blessés mais ";}
                            else if(dmgCo > 0){button += " tu t'es blessé mais ";}
                            button += player.sail + " nassolfière";
                            if(player.sail >= 2){button += "s</span> qui vont ";}
                            else{button += "</span> qui va ";}
                            button += "ainsi permettre de se nourrir facilement de créatures volantes lors de chaque prochaines journées.\");'>Convaincre</button>";
                        }else if(rng === 1 && (player.stone > 0 || statue > 0)){
                            if(statue === 0){
                                h1 = "Prier Gragheskr ?";
                                back = "Lors du repas du soir, tu remarques que certains de ceux qui te suivent déposent au sol une partie de leurs maigres ressources de nourriture. Font-ils les difficiles en ces temps de pénurie ? Tu vas les voir et en discutes avec eux. Ils t’expliquent que c’est une offrande à "+definitionOf("Gragheskr")+". Le débat est lancé sur l’utilité d’un tel acte et d’autres viennent très vite se rajouter à votre échange verbal. Suite à de nombreux arguments avancés, la question est posée : devez-vous ériger la plus belle des statues possible avec <span class=important_txt>toutes les roches en stock</span> en l’honneur de "+definitionOf("Gragheskr")+" et prier en espérant ses bonnes grâces ? Personne ne sait faire de statue donc il a un <span class=risk_percentage title=\"une chance sur quatre d’être blessés\">petit risque</span> de se blesser mais tous pensent que ça en vaut le coup.";
                                calcDmgCo(player.workerAvaible, 0.25);
                                button = "<button onclick='"+pGU+" conseqRisk(\"non\");'>Non</button> <button onclick='statue = player.stone; player.stone = 0; player.workerAvaible -= "+dmgCo+"; player.wounded += "+dmgCo+"; "+pGU+" conseqRisk(\"accord\", "+dmgCo+");'>D'accord</button>";
                            }else{
                                h1 = "Un cadeau de la terre";
                                back = "En arrivant au campement tu entends des remerciements et des louanges. Tu t’approches et remarques au centre du groupe formé par les tiens des ressources qui semblent sortir du sol, comme des bulles d’air qui explosent à la surface. Tu te mets à genoux et remercies également "+definitionOf("Gragheskr")+".<br>";
                                let z = [];//Balancing
                                z[0] = statue+parseInt(Math.random()*5);      z[1] = statue+parseInt(Math.random()*5);
                                z[2] = statue+parseInt(Math.random()*5);      z[3] = statue+parseInt(Math.random()*5);
                                back += "+"+z[0]+" "+img("wood")+" +"+z[1]+" "+img("stone")+" +"+z[2]+" "+img("fiber")+" +"+z[3]+" "+img("food");
                                button = "<button onclick='player.wood += "+z[0]+"; player.stone += "+z[1]+"; player.fiber += "+z[2]+"; player.food += "+z[3]+";"+pGU+" update(\"map\");'>S'endormir</button>";
                            }
                        }else if(rng === 2 && player.wood > 0){
                            h1 = "Entrer dans l'antre ?";
                            back = "De retour au camp à la nuit tombée, l’une des tiens annonce avoir découvert <span class=important_txt>un antre</span> non loin de là : l’entrée d’un tunnel qui s’enfonce sous terre par une trappe délabrée. Une ancienne mine ? Quoi qu’il en soit, elle pense qu’il pourrait être très intéressant d’envoyer tout le monde pour consolider la structure et ainsi pouvoir fouiller ces galeries. C’est selon elle <span class=risk_percentage title=\"une chance sur deux d’être blessés\">moyennement risqué</span> et cela demanderait la <span class=important_txt>totalité de votre bois</span> pour aménager des poutres et avancer le plus loin possible afin de récupérer progressivement les ressources qui s’y trouvent.<br>Qu’en penses-tu ? Faut-il envoyer tes gens l’aider ?";
                            calcDmgCo(player.workerAvaible, 0.5);
                            let rNow = [player.wood+parseInt(Math.random()*5), player.wood+parseInt(Math.random()*3), player.wood+parseInt(Math.random()*5)];//Balancing
                            button = "<button onclick='"+pGU+" conseqRisk(\"abandonner\");'>Abandonner</button> <button onclick='player.workerAvaible -= "+dmgCo+"; player.wounded += "+dmgCo+"; player.stone += "+rNow[0]+"; player.ore += "+rNow[1]+"; player.food += "+rNow[2]+"; player.wood = 0; board.stoneAvaible["+player.localisation+"] += "+(3*player.wood+parseInt(Math.random()*5))+"; board.fiberAvaible["+player.localisation+"] += "+(2*player.wood+parseInt(Math.random()*5))+"; board.foodAvaible["+player.localisation+"] += "+(2*player.wood+parseInt(Math.random()*5))+";"+pGU+" conseqRisk(\"consolider\", ["+dmgCo+","+rNow+"]);'>Consolider</button>";//Balacing
                        }else if(rng === 3){
                            h1 = "Chevaucher le flux ?";
                            back = "À la nuit tombée, tu te rends compte que tu t’es un peu trop éloigné des autres. Tu peines à retrouver ton chemin et l’obscurité associée à une bourrasque de vent te font dégringoler et rouler le long d’une pente. Par réflexe, tu apposes tes mains sur ta tête et ta nuque au niveau des parties non couvertes par le masque, tu écartes au maximum tes jambes pour freiner ta chute. Après quelques secondes qui te paraissent interminables, tu te stoppes après une glissade sur les fesses. Tu ouvres tes mains, regarde autour de toi. Tu sens le vent bien plus fort à cet endroit : <span class=important_txt>un flux</span>. Idéal pour se déplacer plus vite et gagner une journée sur la "+definitionOf("guguwa")+". Tu remontes la pente non sans mal et te guide grâce aux "+definitionOf("tauran")+" qui sont apparues.<br>Tu arrives ensuite rapidement au campement, guidé par les voix de ceux partis à ta recherche. Tu te dépêches de leur expliquer ta découverte, ce flux, et leur demandes ce qu’ils en pensent. Ils discutent entre eux et avec toi mais une réponse claire et rapide n’arrive pas à s’en dégager. Tant pis, tu décides de trancher suite à cet échange qui te semble interminable et contre-productif. En effet, il ne faut pas perdre une minute car le flux risque de changer de place ou de s’affaiblir. Que leur annonces-tu ?<br>Prendre le <span class=risk_percentage title=\"trois chances sur quatre d’être blessés\">grand risque</span> de se blesser à se déplacer dans le noir et dans le flux mais <span class=important_txt>ne pas perdre une journée</span> sur la "+definitionOf("guguwa")+", ou attendre le lendemain en espérant que le flux sera toujours là, même si personnellement tu n’y crois pas ?";
                            calcDmgCo(player.workerAvaible, 0.75);
                            button = "<button onclick='"+pGU+" conseqRisk(\"attendre\");'>Attendre</button> <button onclick='player.workerAvaible -= "+dmgCo+"; player.wounded += "+dmgCo+"; player.daysBeforeStorm ++; "+pGU+" conseqRisk(\"y aller\", "+dmgCo+");'>Y aller</button>";
                        }else if(rng === 4){
                            h1 = "Des voyageurs venus d’ailleurs ?";
                            let nbTrav = parseInt(Math.random()*2)+4;
                            calcDmgCo(player.workerAvaible, 0.75);
                            if(nbTrav >= 5 && dmgCo < player.workerAvaible){dmgCo ++;}
                            let wWDeath = player.wounded;
                            let rSteal = [];
                            rSteal[0] = parseInt(Math.random()*3);    rSteal[1] = parseInt(Math.random()*5);
                            rSteal[2] = parseInt(Math.random()*3);    rSteal[3] = parseInt(Math.random()*5);
                            rSteal[4] = parseInt(Math.random()*3);    rSteal[5] = parseInt(Math.random()*5);
                            rSteal[6] = nbTrav;
                            back = "C’est un début de nuit calme. Peu de bruit aux alentours, pas de feu pour économiser du bois et aucune discussion car vous êtes tous très fatigués. Quelques rongeurs passent même nonchalamment à la lisière du camp observant ce tableau semblant fait de statues ou d’esprits errants. Ce n’est pas la première soirée qui se finit ainsi, amorphe. Cependant, tu entends tout d’un coup des bruits au loin. Tu tends l’oreille : des voiles qui claquent, des coques qui grincent… <span class=important_txt>d’autres voyageurs</span> du "+definitionOf("tashi")+". Tu demandes à ton voisin si il a entendu la même chose que toi. Il hoche la tête et fait signe qu’il part en reconnaissance, silencieux.<br>Il réapparaît furtivement une bonne demie-heure après. C’est un groupe de <span class=important_txt>"+nbTrav+" voyageurs</span>, visiblement peu armés, qui se sont arrêtés pour la nuit et qui repartiront, de ce qu’ils disent, à l’aube. Il propose de les piller, même si il reconnaît que cela semble <span class=risk_percentage title=\"trois chances sur quatre d’être blessés\">très risqué</span>. Il estime leur stock à : ";
                            let mTxt = "";
                            for(i=0; i<7; i++){
                                let min = rSteal[i]-parseInt(Math.random()*2);
                                let max = rSteal[i]+parseInt(Math.random()*3);
                                if(min < 0){min = 0;}
                                if(rSteal[i] > 0){mTxt += " "+min+" - "+max+" "+img(ressourcesName[i]);}
                            }
                            back += mTxt;
                            back += "<br>Que préconises-tu ? Prendre le risque de blesser les tiens pour dérober leurs ressources, ou rester discret et ne rien faire pour ne pas se faire repérer ?";
                            button = "<button onclick='"+pGU+" conseqRisk(\"rester discret\");'>Rester discret</button> <button onclick='player.workerTotal -= "+wWDeath+"; player.wounded = 0; player.workerAvaible -= "+dmgCo+"; player.wounded += "+dmgCo+"; player.wood += "+rSteal[0]+"; player.plank += "+rSteal[1]+"; player.stone += "+rSteal[2]+"; player.ore += "+rSteal[3]+"; player.fiber += "+rSteal[4]+"; player.sail += "+rSteal[5]+"; player.food += "+rSteal[6]+"; "+pGU+" conseqRisk(\"dérober le stock\", ["+wWDeath+","+dmgCo+","+rSteal+"]);'>Dérober le stock</button>";
                        }else if(rng === 5 && player.workerAvaible > 1){
                            h1 = "Nouveau bauta ?";
                            let mGod = ["Tsawol","Woushafigewa"];
                            mGod = mGod[parseInt(Math.random()*2)];
                            back = "Tu leur avais pourtant dis quel bois utiliser pour le feu, la dense fumée provoquée par le bois vert qu’ils ont dû mettre a attiré un groupe de "+definitionOf("bautan")+" de "+definitionOf(mGod)+". Il est vrai que cela aurait pu être pire, mais tu as autre chose à faire que de discuter avec ces personnes vêtues <span class=important_txt>";
                            if(mGod === "Tsawol"){back += "de simarres noires à la bavette et les épaulières blanches, et qui portent des masques d’argent au gousset de sable";}
                            else{back += "de simarres blanches mouchetées aux manches noires, et qui portent des masques d’orangé au pal de sable mantelé d’argent";}
                            back += "</span>. Au moins ils transportent avec eux des chariots dont un de nourriture, ce qui t’a permis de ne pas avoir à leur proposer vos rations. Et tu ne vas pas te plaindre : ils ne discutent pas trop avec toi, ils semblent davantage parler avec les plus jeunes, comme si ils étaient plus intéressants. Mais tu apprécies qu’ils ne soient pas dans tes pattes.<br>En fin de soirée, alors que tu allais les congédier pour que tout le monde aille dormir, celui avec un <span class=important_txt>masque ";
                            if(mGod === "Tsawol"){back += "au gousset accolé d'une ligne d'or";}
                            else{back += "aux lambrequins sable";}
                            back += "</span> s’approche de toi, suivi d’un petit jeune de ton groupe. Celui qui te semble être le représentant de ces "+definitionOf("bautan")+" t’explique s’être longuement entretenu avec le jeune homme et il pense que ce dernier pourrait, avec ton accord, rejoindre sa troupe de "+definitionOf("bautan")+" de "+definitionOf(mGod)+". Il invoque une histoire de bienfait pour le jeune, d’absence de hasard et de connexion. Il vend ses principes et… tu t’endormirais presque quand soudain, il te parle de chariot. Tu sursautes, portes une main sur ta hache pensant qu’il veut s’en prendre à vos maigres ressources. Mais visiblement c’est l’inverse. Il te propose une partie de son stock en te pointant un chariot à voile, si tu laisses le jeune partir avec lui. Un coup d’œil au jeune, il semble d’accord, un coup d’œil au chariot, tu y estimes : ";
                            let bautanGive = [];
                            let nbProbaDayMax = player.daysBeforeStorm;
                            for(i=board.spotJ[player.localisation]+2; i<18; i+=2){
                                nbProbaDayMax += board.daysBeforeStorm[board.spotJ.indexOf(i)];
                            }
                            let nbUnits = nbProbaDayMax - (8+3) - (nbProbaDayMax/4);//Solotage of wagon & food
                            if(nbUnits < 5){
                                bautanGive[7] = 0;
                                nbUnits += (8+3);
                            }else{
                                bautanGive[7] = 1;
                            }
                            nbUnits = nbUnits/10;//to divide for each ressources
                            bautanGive[0] = parseInt(nbUnits*2*3)-parseInt(Math.random()*3);if(bautanGive[0] < 0){bautanGive[0] = 0;}
                            bautanGive[1] = parseInt(nbUnits*3*4)-parseInt(Math.random()*5);if(bautanGive[1] < 0){bautanGive[1] = 0;}
                            bautanGive[2] = parseInt(nbUnits*2*4)-parseInt(Math.random()*3);if(bautanGive[2] < 0){bautanGive[2] = 0;}
                            bautanGive[3] = parseInt(nbUnits*4*2)-parseInt(Math.random()*5);if(bautanGive[3] < 0){bautanGive[3] = 0;}
                            bautanGive[4] =parseInt(nbUnits*2*10)-parseInt(Math.random()*5);if(bautanGive[4] < 0){bautanGive[4] = 0;}
                            bautanGive[5] = parseInt(nbUnits*2)-parseInt(Math.random()*3);  if(bautanGive[5] < 0){bautanGive[5] = 0;}
                            bautanGive[6] = parseInt(nbUnits*4)-parseInt(Math.random()*5);  if(bautanGive[6] < 0){bautanGive[6] = 0;}
                            //Balancing
                            for(i=0; i<7; i++){//display
                                if(bautanGive[i] > 0){
                                    let min = bautanGive[i]-parseInt(Math.random()*3);
                                    if(min < 0){min = 1;}
                                    let max = bautanGive[i]+parseInt(Math.random()*5);
                                    back += " "+min+" - "+max+" "+img(ressourcesName[i]);
                                }
                            }
                            back += " <span class=important_txt>";
                            if(bautanGive[7] === 1){back += "ainsi que";}else{back += "sans";}
                            back += " le chariot</span> pour tout transporter. Si tout le monde est d’accord qu’importe le choix, c’est à toi de trancher. Qu’est-ce qui est le mieux pour l’ensemble de ceux qui te suivent ? Garder le jeune pour avoir plus de bras pour aider à survivre, ou le laisser partir vivre avec les bautan en échange de ces ressources ?";
                            button = "<button onclick='"+pGU+" conseqRisk(\"garder\");'>Garder</button> <button onclick='player.workerAvaible --; player.workerTotal --; ";
                            if(bautanGive[7] === 1){button += "buildings.quantityTotal[buildings.name.indexOf(\"wagon\")] ++; ";}
                            button += "player.wood += "+bautanGive[0]+"; player.plank += "+bautanGive[1]+"; player.stone += "+bautanGive[2]+"; player.ore += "+bautanGive[3]+"; player.fiber += "+bautanGive[4]+"; player.sail += "+bautanGive[5]+"; player.food += "+bautanGive[6]+"; "+pGU+" conseqRisk(\"laisser\", ["+bautanGive+"]);'>Laisser</button>";
                        }else{//rng = 6-7-8
                            back = "C’est la fin d’après-midi quand tu vois une des femmes se diriger vers toi avec une corde lovée en bandoulière, et une torche éteinte à sa ceinture. Elle a l’habitude de vagabonder à droite et à gauche et en cette fin de journée elle t’apprend qu’elle a découvert ";
                            if(rng === 6){h1 = "Descendre en rappel ?"; back += "<span class=important_txt>une faille</span> avec du "+definitionOf("lin abrufil")+" tout en bas.";}
                            else if(rng === 7){h1 = "Fouiller un temple ?"; back += "l’entrée d’<span class=important_txt>un temple effondré</span> sur lui même, propice à la récolte de pierre.";}
                            else{h1 = "Escalader une paroi ?"; back += "une voie pour escalader <span class=important_txt>un plateau boisé</span> pour y récupérer du gros bois.";}
                            back += "<br>C’est <span class=risk_percentage title=\"une chance sur deux d’être blessés\">moyennement risqué</span> de s’y rendre mais de ce qu’elle a entre-aperçu, vous pourriez y récolter : ";
                            let z = parseInt(Math.random()*3+7);//Balancing
                            back += (z-parseInt(Math.random()*2+1)) + " - " + (z+parseInt(Math.random()*2+1)) + " ";
                            if(rng === 6){back += img("fiber");}
                            else if(rng === 7){back += img("stone");}
                            else{back += img("wood");}
                            back += "<br>Elle soumet l’idée que cela pourrait également être le moment opportun pour un travail d’équipe et que plus tu enverras de personnes avec elle, plus il y aura de <span class=risk_percentage title=\"1, 2 ou 3 chances sur 4\">chance de récolter</span> quelque chose. Apparemment c’est du <span class=important_txt>tout ou rien</span> : soit vous y arrivez, soit l’équipe rebrousse chemin bredouille, questions de sécurité et de risque obligent. Elle continue de t’abreuver de détails mais tu ne retiens rien d’autre que le nombre maximum de coéquipiers qui peuvent l’accompagner ne peut excéder deux à cause, d’après ce que tu comprends, de la corde, du poids et de la tension qu’elle peut supporter.<br>Combien de personnes veux-tu envoyer ?";
                            button = "<button onclick='"+pGU+" conseqRisk(\"aucune\");'>Aucune</button>";
                            for(i=1; i<=3; i++){
                                button += " <button onclick='player.workerAvaible -= ";
                                calcDmgCo(i, 0.5);
                                button += dmgCo + "; player.wounded += " + dmgCo + "; ";
                                let zz;
                                if(Math.random() < 0.25*i){//success
                                    if(rng === 6){button += "player.fiber += "+z+";"; zz=z;}
                                    else if(rng === 7){button += "player.stone += "+z+";"; zz=z;}
                                    else{button += "player.wood += "+z+";"; zz=z;}
                                }else{zz = 0;}
                                button += pGU +" conseqRisk(\"nombre\", ["+rng+","+zz+","+dmgCo+"]);' ";
                                if(player.workerAvaible < i){button += "class=unclicable DISABLED";}
                                button += ">";
                                for(j=0; j<i; j++){button += img("worker")+" ";}
                                button += "</button>";
                            }
                        }
                    }

                    insideDiv = "<h1>"+ h1 +"</h1><p>" + back +"</p><p style='text-align:center;'>"+ button +"</p>";

                    //First night
                    if(tutoStep === 1){
                        insideDiv = "<p>Lors de tes déplacements de lieu en lieu, ou de façon régulière chaque soir à la tombée de la nuit, en plus du fait que chaque personne mange une ration de nourriture, des évènements inattendus peuvent survenir et perturber le campement.<br>À la fin de ce premier déplacement laborieux et chargé en émotion, vous montez le camp. Tu décides alors de raconter l’histoire de <span class=important_txt>Mebruka</span> pour donner du courage et de l’espoir à ceux qui t’entourent.<br>À l’abri du vent, derrière le "+definitionOf("zuriya mayafi")+" à moitié retourné vous servant de tente pour la nuit, tu te poses dans l’herbe et inspires un long moment en fermant les yeux. Le sol est plus meuble qu’avant, la brise toujours chuchotante, la drisse du chariot claque légèrement, la douce odeur d’un "+definitionOf("acacia résimiel")+" flotte dans l’air, les battements de ton cœur semblent ralentir. Les derniers rayons de "+definitionOf("rana")+" réchauffent les corps avant le début de la nuit.</p>";
                        insideDiv += "<p style='text-align:center;'><button onclick='player.needToChoose=false;update(\"gather\");'>S'endormir</button></p>";
                        tutoStep=2;
                    }else{tutoStep=0;}

                    //Sacrifice
                    if(player.sacrificeMade >= 42){
                        insideDiv = "<h1>Navire divin</h1><p>Vous décidez de vous arrêter, non pas à cause de la fatigue qui se dessine sur tous les visages, ni à cause de la tombée du "+definitionOf("rana")+" à l’horizon et qu’il serait temps de s’occuper du campement, mais car vous êtes tombés nez à nez avec quelque chose d’incroyable : un <span class=important_txt>navire à voile</span> d’une rare beauté. Une coque intacte sculptée d’arabesques rehaussées d’un verni bleu-vert, des voiles comme neuves teintées à l’ancienne grâce à l’"+definitionOf("œillet veiné")+" et brodées de délicats symboles blancs le long de la chute, un pont large et sans éraflure tatoué de nœuds de bois aux formes géométriques et un gréement impeccable ponctué de touches de couleurs.<br>Après une bref analyse de cette merveille et ayant l’assurance qu’elle était abandonnée, tu décides d’ajouter ce cadeau du vent à votre flotte. Ainsi, vous pourrez transporter plus de ressources et de structures de lieux en lieux. Dommage que ce divin navire ne soit pas apparu la veille, cela vous aurez permis de ne pas jeter de ressources.</p>";
                        insideDiv += "<p style='text-align:center;'><button onclick='player.needToChoose=false;update(\"map\");'>S'endormir</button></p>";
                        player.sacrificeMade = "done";
                    }

                    //Turn again if noRessources
                    if(noRessources === true && tutoStep === 0){
                        update("night");
                    }else{
                        document.getElementById('main_div').innerHTML = insideDiv;
                    }
                }
////////////////
                else if(witchDiv == "end"){
                    document.getElementById('dashboard_div').innerHTML = "";
                    document.getElementById('stat_div').innerHTML = "";
                    if(player.workerTotal <= 0){
                        insideDiv = "<h1>Défaite - Mort</h1>";
                        insideDiv += "<p>En voyant l’arme s’abattre sur toi tu réalises que vous n’étiez pas prêts, pas assez endurants, pas fait pour…</p>";
                    }else if(player.daysBeforeStorm === 0){
                        insideDiv += "<h1>Défaite - Envolé</h1>";
                        insideDiv += "<p>En sentant d’un coup le vent forcir, tu regrettes d’être resté un jour de plus. Pas le choix selon toi mais tu t’es montré trop avide de ressources. Les voiles, à la merci des forces aériennes, se sont déchirées sous le coup, scellant votre sort, la "+definitionOf("guguwa")+" fonçant droit vers vous.</p>";
                    }else if(player.food < 0){
                        insideDiv += "<h1>Défaite - Affamé</h1>";
                        insideDiv += "<p>Tu avais tellement de choses à gérer que tu ne t’es pas rendu compte que certains étaient gourmands. Vous avez vidé votre stock de nourriture à la vitesse d’un zéphyr. Plus de force pour effectuer la moindre tâche étant donnée l’accumulation de fatigue. Tu relèves péniblement la tête pour observer une dernière fois les steppes, alors que la faim te tiraille plus fort que d’habitude et que des ombres voilent tes yeux.</p>";
                    }else{
                        insideDiv += "<h1>Victoire</h1>";
                        insideDiv += "<p>À bout de souffle vous arrivez à la forteresse des montagnes. L’entrée est reconnaissable aux dalles taillées menant aux sculptures élancées faites à même la roche : frontière entre nature brute et travail de l’homme. Une foule de personnes bruyantes traînant des chariots arrimés des affaires de leur quotidien se pressent sur le chemin. Les gens se bousculent, s’alpaguent, vous lancent des regards interrogateurs, étonnés qu’une "+definitionOf("kabila")+" des steppes arrive si tard. Quelques gardes positionnés le long de la route clament de brefs ordres pour coordonner ce flux humain. Le flot devient plus dense à mesure que vous avancez.<br>Une femme s’avance à contre-courant vers toi : uniforme serré de la forteresse, masque <span class=important_txt>de gueules au chevron d’argent</span>, et écritoire à pince à la main. Après y avoir noté vos noms et distinctifs, elle tourne d’un pas lourd et militaire autour de votre "+definitionOf("zuriya mayafi")+" et de vos chariots pour examiner le chargement. Son attitude traduit une certaine hésitation, mais elle finit par hocher la tête. Elle sort alors un sceau de sa besace et tamponne vos biens avant de te remettre le fameux laisser-passer. Elle te pointe l’enclos où vous allez déposer votre chargement : la plus grande partie sert à vous acquitter de la taxe d’entrée et vous récupérez le surplus en monnaie. Vous prenez désormais place dans la file pour franchir les hautes portes massives et entrez dans le cœur de la montagne.<br>Alors que, soulagé, tu te projettes dans cette vie « à l’intérieur », un grand vide s’ouvre en toi : l’absence de vent.</p>";
                    }
                    insideDiv += "<h2>Titres - Accomplissements</h2>";
                    let diffBuildings = 0;
                    for(i=0; i<buildings.name.length; i++){
                        if(constructator[i]){diffBuildings ++;}
                    }
                    let valDivine = "";
                    if(howManyCredits("all") >= taxe[0]+taxe[1]+taxe[2]){valDivine = " (+"+(howManyCredits("all")-taxe[0]-taxe[1]-taxe[2])+")";}
                    let achievements =
                    [[player.workerTotal > 0 && player.food >= 0 && player.daysBeforeStorm > 0, "Sauveur", "Arriver jusqu’à la forteresse"],
                    [howManyCredits("all") >= taxe[0]+taxe[1], "Vie paisible", "En attendant que la guguwa passe"],
                    [howManyCredits("all") >= taxe[0]+taxe[1]+taxe[2], "Vie divine"+valDivine, "Mener une vie divine dans la forteresse"],
                    [player.workerTotal >= 10, "Fédérateur", "Former un groupe d'au moins 10 personnes"],
                    [player.workerTotal === 1, "Solitaire", "Seul toi ? Non, vous êtes plein dans ta tête"],
                    [statue > 0, "Bauta de Gragheskr", "Ériger une statue en l’honneur du serpent"],
                    [sake === "played", "Pousseur de chance", "Joueur de sake et mise en abymes"],
                    [ocarina === "played", "Musicien", "Apaiser les coeurs par la musique"],
                    [player.sacrificeMade === "done", "Élu", "Savoir sacrifier pour le vent"],
                    [diffBuildings === buildings.name.length, "Constructeur", "Avoir construit une fois toutes les structures"]];
                    for(i=0; i<achievements.length; i++){
                        if(achievements[i][0]){
                            insideDiv += "<table class=achievements><tr><th>"+img("achieved")+" "+achievements[i][1]+"</th></tr><tr><td>"+achievements[i][2]+"</td></tr></table> ";
                        }else{
                            insideDiv += "<table class=\"achievements unclicable\"><tr><th>"+img("achieved")+" "+achievements[i][1]+"</th></tr><tr><td>"+achievements[i][2]+"</td></tr></table> ";
                        }
                    }
                    insideDiv += "<p style=\"text-align:center;\"><button onclick='window.location.href=\"\"'>Recommencer</button></p>";
                    document.getElementById('main_div').innerHTML = insideDiv;
                }
////////////////
                else{
                    document.getElementById('main_div').innerHTML = witchDiv;
                }
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function conseqRisk(buttonName, values){
                let txtToMain = "";
                if(buttonName === "non"){
                    txtToMain = "Il y a trop de risque et trop de perte de ressources, vous ne pouvez pas vous le permettre selon toi. En plus, rien ne dit que la "+definitionOf("tehanegh")+" entende vos prières et verra vos offrandes. Mieux vaut rester solide sur vos acquis à ton avis.";
                }else if(buttonName === "accord"){
                    txtToMain = "Tu penses également qu’il serait bon de demander l’aide de la "+definitionOf("tehanegh")+" c’est pourquoi tu décides de mener le chantier de construction de la statue. Après quelques heures nocturnes à trimer et de nombreuses blessures et éraflures";
                    if(values > 0){
                        txtToMain += " (";
                        for(i=0; i<values; i++){txtToMain += img("wounded");}
                        txtToMain +=")";
                    }
                    txtToMain += ", ce qui ressemble à une statue se tient devant toi, taillée dans la roche de manière approximative mais on reconnaît les écailles. Tu espères que malgré son aspect vous bénéficierez du soutien de "+definitionOf("Gragheskr")+".";
                }else if(buttonName === "abandonner"){
                    txtToMain = "Envoyer des gens sous terre te semble trop risqué, surtout avec ces installations instables. De plus, tu n’es pas persuadé de trouver quoi que ce soit dans ces galeries miteuses.";
                }else if(buttonName === "consolider"){
                    txtToMain = "Ton avis concorde avec le sien et tu décides d’envoyer le groupe et le bois pour renforcer l’accès à cet antre que tu espères plein de richesse. Tout le monde descend et commence à consolider la structure.<br>Après plusieurs heures d’effort, tout le bois disponible a été utilisé pour soutenir la voûte.";
                    if(values[0] >=2){
                        txtToMain +=" Cela n’a pas été aisé car <span class=important_txt>"+values[0]+" personnes ont été blessées</span>.";
                    }else if(values[0] === 1){
                        txtToMain +=" Cela n’a pas été aisé car <span class=important_txt>une personne a été blessée</span>.";
                    }
                    txtToMain += "<br>De cette première expédition, vous arrivez à sortir : ";
                    txtToMain += values[1]+" "+img("stone")+" +"+values[2]+" "+img("ore")+" +"+values[3]+" "+img("food");
                    txtToMain += "<br>Le reste, il faudra le <span class=important_txt>Récolter</span> petit à petit, de plus en plus profondément, lors des jours suivants.";
                }else if(buttonName === "attendre"){
                    txtToMain = "En ce début de matinée vous vous rendez sur le site de ta chute. Comme il fallait s’y attendre, plus de flux, le calme plat. Vous entamez la journée avec le moral au plus bas, certains viennent s’excuser. Tu ne le leur reproches pas vraiment ce qui s’est passé… après tout, ils auraient pu avoir raison même si ils ont moins d’expérience que toi.";
                }else if(buttonName === "y aller"){
                    txtToMain = "N’en déplaise à certains, tu prends les choses en main, montes sur une caisse et de ta hauteur commences à lancer des ordres pour coordonner le groupe. Tu les encourages à se dépêcher et tu fais de même.<br>Le cortège se met en branle et vous louvoyez dans la nuit pour retrouver le flux. Tu te souviens facilement de l’endroit, et une fois tout le monde prêt, vous entrez dedans, d’un bloc. Le choc est violent. Beaucoup se blessent <span class=important_txt>";
                    if(values > 0){txtToMain += "("+values+") ";}
                    txtToMain += "</span>mais vous arrivez en un seul morceau en bas de la pente et continuez ainsi un peu avant que le flux ne s’atténue de lui même. Grâce à cette manœuvre vous n’avez pas perdu l’avance pris sur la "+definitionOf("guguwa")+" tout en restant à proximité des ressources du lieu à récolter. Vous montez un nouveau camp à la hâte et prenez quelques heures de repos avant le levé du "+definitionOf("rana")+".";
                }else if(buttonName === "rester discret"){
                    txtToMain = "Tu calmes les ardeurs de l’homme et, tout en lui donnant le reste de ton frugal repas, lui fais prendre conscience que finalement vos situations se ressemblent beaucoup. Il grogne, visiblement pas tout à fait d’accord, mais accepte le repas et part d’un pas lourds dormir, ou du moins se reposer.";
                }else if(buttonName === "dérober le stock"){
                    txtToMain = "Après une mise au point de quelques signes discrets pour vous coordonner, tu traces sur le sol des formes pour expliquer la stratégie d’attaque. Vous allez les encercler et au signal vous jeter sur eux. Simple et efficace, en théorie. Place à la pratique.<br>Accroupis ou rampants, vous vous dirigez vers le groupe de voyageurs. Ils sont plus bruyants que tout à l’heure et mangent avec insouciance. Tant mieux pour vous. Le signal est donné. Vous vous ruez sur eux. Le combat fait rage avec vos armes improvisées et vous prenez rapidement l’avantage grâce à l’effet de surprise. En effet, en peu de temps vous arrivez à les mettre hors d’état de nuire et en profitez pour subtiliser ce qui n’a pas été abîmé durant la bataille.<br>C’est une fois retourné au campement que tu fais le bilan de l’opération : <span class=important_txt>";
                    if(values[0] >= 2){txtToMain += values[0] + " morts ";}
                    else if(values[0] === 1){txtToMain += "un mort ";}
                    if(values[0] > 1 && values[1] > 1){txtToMain += "et ";}
                    if(values[1] >= 2){txtToMain += values[1] + " blessés, ";}
                    else if(values[1] === 1){txtToMain += "une blessée, ";}
                    txtToMain += "</span>";
                    if(values[0] > 1 || values[1] > 1){txtToMain += "mais ";}
                    let mTxt = "";
                    for(i=0; i<7; i++){
                        if(values[i+2] > 0){mTxt += " +"+values[i+2]+" "+img(ressourcesName[i]);}
                    }
                    txtToMain += mTxt.slice(2);
                    txtToMain += "<br>Pas le temps de s’apitoyer, repos de courte durée avant d’entamer une nouvelle journée.";
                }else if(buttonName === "aucune"){
                    txtToMain = "Tu la connais depuis le temps, toujours très enthousiaste, sûre d’elle, très imaginative et force de proposition. Mais sur ce coup là, tu penses que ce sont des risques inutiles que tu ferais prendre aux tiens. Tu as besoin qu’ils soient frais et en forme car tu sais déjà ce qu’il devront faire comme tâche le lendemain. Pas de contorsionnisme ce soir.";
                }else if(buttonName === "nombre"){
                    txtToMain = "À peine as-tu donné ton accord qu’elle fonce préparer le terrain à l’aide d’une torche pour s’éclairer.<br>Après plusieurs heures où tu ne sais pas grand-chose de ce qu’il se passe, tu la vois revenir faire son rapport. C’est ";
                    if(values[1] > 0){
                        txtToMain += "<span class=important_txt>une réussite</span> : "+values[1]+" ";
                        if(values[0] === 6){txtToMain += img("fiber");}
                        else if(values[0] === 7){txtToMain += img("stone");}
                        else{txtToMain += img("wood");}
                        if(values[2] > 0){txtToMain += " mais ";for(i=0;i<values[2];i++){txtToMain += img("wounded");}}
                        else{txtToMain += " et aucun blessé.";}
                    }else{
                        txtToMain += "<span class=important_txt>un échec</span> : aucune ressource, ";
                        if(values[2] >= 2){txtToMain += "et en plus de ça <span class=important_txt>"+values[2]+" sont blessés</span>.";}
                        else if(values[2] === 1){txtToMain += "et en plus de ça <span class=important_txt>elle est blessée</span>.";}
                        else{txtToMain += "mais heureusement personne ne s’est blessé.";}
                    }
                }else if(buttonName === "garder"){
                    txtToMain += "Pas maintenant. Tu veux bien laisser le jeune adorer qui il veut mais une fois arrivés à la forteresse des montagnes. Choisir maintenant serait trop précipité. Et puis tout le groupe à besoin de lui, c’est dans l’intérêt commun que tu le convaincs de rester avec vous. Tes deux locuteurs semblent satisfaits par ta réponse et partent chacun de leur côté.";
                }else{//laisser
                    txtToMain += "Si le jeune en a envie, et si de plus vous obtenez compensation, pourquoi refuser ? Le jeune s’en va avec le froissement des simarres des "+definitionOf("bautan")+". Il ne reste à sa place ";
                    if(values[7] === 1){txtToMain += "qu’un chariot bien rempli";}
                    else{txtToMain += "que quelques resssources empilées";}
                    txtToMain += ".<br>";
                    let mTxt = "";
                    for(i=0; i<7; i++){
                        if(values[i] > 0){mTxt += " +"+values[i]+" "+img(ressourcesName[i]);}
                    }
                    txtToMain += mTxt.slice(2);
                    if(values[7] === 1){txtToMain += " + "+buildings.img("wagon");}
                }
                document.getElementById('main_div').innerHTML = "<p>"+txtToMain+"</p>";
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function updateStat(nbSpot){
                insideDiv = "<h2>Ressources du lieu</h2>";
                insideDiv += "<table><tr><td>";
                if(player.vision.indexOf(nbSpot) === -1){insideDiv += approxRessources(board.woodAvaible[nbSpot]);}
                else{insideDiv += board.woodAvaible[nbSpot];}
                insideDiv += "</td><td>"+img("wood")+"</td></tr>";
                insideDiv += "<tr><td>";
                if(player.vision.indexOf(nbSpot) === -1){insideDiv += approxRessources(board.stoneAvaible[nbSpot]);}
                else{insideDiv += board.stoneAvaible[nbSpot];}
                insideDiv += "</td><td>"+img("stone")+"</td></tr>";
                insideDiv += "<tr><td>";
                if(player.vision.indexOf(nbSpot) === -1){insideDiv += approxRessources(board.fiberAvaible[nbSpot]);}
                else{insideDiv += board.fiberAvaible[nbSpot];}
                insideDiv += "</td><td>"+img("fiber")+"</td></tr>";
                insideDiv += "<tr><td>";
                if(player.vision.indexOf(nbSpot) === -1){insideDiv += approxRessources(board.foodAvaible[nbSpot]);}
                else{insideDiv += board.foodAvaible[nbSpot];}
                insideDiv += "</td><td>"+img("food")+"</td></tr>";

                if(nbSpot != player.localisation && isSpotAvailable(nbSpot)){
                    insideDiv += "</table><h2>Gain et coût</h2><table><tr><td>+" +board.daysBeforeStorm[nbSpot];
                    if(buildings.quantityTotal[buildings.name.indexOf("spinnaker")] > 0){
                        insideDiv += " <span title=\""+buildings.nameFr[buildings.name.indexOf("spinnaker")]+"\" style=\"cursor:help;\">+"+buildings.quantityTotal[buildings.name.indexOf("spinnaker")]+"</span>";}
                    insideDiv += "</td><td>"+img("time")+"</td></tr>";
                    insideDiv += "<tr><td class=warning><span title=\"Nourriture pour le trajet ("+board.foodLost[nbSpot]+") + quotidienne ("+player.workerTotal+")\" style=\"cursor:help;\">-" +(board.foodLost[nbSpot]+player.workerTotal)+"</span></td><td>"+img("food")+"</td></tr></table>";

                    insideDiv += "<button onclick='player.changeLocalisation(" +nbSpot+ "," +board.foodLost[nbSpot]+ "); board.upClass("+nbSpot+"); updateStat("+nbSpot+"); nextDay();' ";
                    if(player.workerAvaible+player.wounded < player.workerTotal){insideDiv += "class=unclicable title='Nous avons besoin de tout le monde pour pouvoir partir' DISABLED";}
                    else if(player.food < board.foodLost[nbSpot]+player.workerTotal){insideDiv += "class=unclicable title='Pas assez de nourriture' style=\"cursor:help;\" DISABLED";}
                    else if(player.weight > player.weightMax){insideDiv += "class=unclicable title='Tu transportes trop de choses, supprime des ressources dans le Stock ou construit des structures de transport' style=\"cursor:help;\" DISABLED";}
                    insideDiv += ">Se déplacer</button>";
                }else if(nbSpot == player.localisation){
                    insideDiv += "</table>";
                    if(player.daysBeforeStorm === 0){insideDiv += "<span class=warning>Il faut partir<br>maintenant !</span><br>";}
                    else if(player.daysBeforeStorm === 1){insideDiv += "<span class=warning>Dernier jour<br>il faut accumuler de la nourriture pour pouvoir faire le voyage</span><br>";}
                    insideDiv += "<button onclick='nextDay();'";
                    if(player.needToChoose || tutoStep == 1){insideDiv += " class=unclicable DISABLED";}
                    insideDiv += ">Fin de journée</button>";
                }else{
                    insideDiv += "</table>";
                }

                //If first spot or last spot
                if(board.spotJ[nbSpot] === 0){
                    insideDiv = "<h2>Les ruines de ton village</h2>";
                }else if(board.spotJ[nbSpot] === 18){
                    insideDiv = "<h2>Forteresse des montagnes</h2>";
                    if(nbSpot != player.localisation && isSpotAvailable(nbSpot)){
                        insideDiv += "<button onclick='player.needToChoose=true; update(\"dashboard\"); update(\"ressources\"); player.daysBeforeStorm ++; update(\"end\");' ";
                        if(howManyCredits("all")< taxe[0]){insideDiv += " title=\"Pas assez de valeur pour payer la taxe\" class=unclicable DISABLED";}
                        else if(player.weight > player.weightMax){insideDiv += "title=\"Trop lourd\" class=unclicable DISABLED";}
                        /*else if(player.food < player.workerTotal){insideDiv += "title=\"Pas assez de nourriture pour le dernier voyage\" class=unclicable DISABLED";}*/
                        insideDiv += ">Finir le tashi</button>";
                    }
                }

                if(player.bookmarked !== "unbook"){
                    insideDiv += "<hr><p class=\"bookmark";
                    if(player.daysBeforeStorm === 0){insideDiv += " unclicable";}
                    insideDiv += "\">";
                    insideDiv += buildings.nameFr[player.bookmarked]+" <button onclick='player.bookmarked=\"unbook\"; updateStat("+player.localisation+");' style=\"border:none;\">"+img("unbookmark")+"</button><br>";
                    insideDiv += buildings.price(player.bookmarked);
                    insideDiv += "<br>"+buildings.buildButton(player.bookmarked, "unbook")+"</p>";
                }

                document.getElementById('stat_div').innerHTML = insideDiv;
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function img(name){
                let nameFR;
                if(name === "wood"){nameFr = "Bois";}
                else if(name === "plank"){nameFr = "Planche";}
                else if(name === "stone"){nameFr = "Roche";}
                else if(name === "ore"){nameFr = "Minerai";}
                else if(name === "fiber"){nameFr = "Fibre";}
                else if(name === "sail"){nameFr = "Voile";}
                else if(name === "food"){nameFr = "Nourriture";}
                else if(name === "worker"){nameFr = "aikin : ceux qui peuvent faire des actions, ouvriers";}
                else if(name === "wounded"){nameFr = "Blessé";}
                else if(name === "weight"){nameFr = "Poids";}
                else if(name === "axe-wood"){nameFr = "Hache en bois";}
                else if(name === "axe-ore"){nameFr = "Hache en métal";}
                else if(name === "pickaxe-wood"){nameFr = "Pioche en bois";}
                else if(name === "pickaxe-ore"){nameFr = "Pioche en métal";}
                else if(name === "basket"){nameFr = "Panier";}
                else if(name === "burn"){nameFr = "Sacrifier la ressource";}
                else if(name === "time"){nameFr = "Jours";}
                else if(name === "achieved"){nameFr = "Validé";}
                else if(name === "bookmark"){nameFr = "Mettre en objectif";}
                else if(name === "unbookmark"){nameFr = "Supprimer";}
                else if(name === "taxe-base"){nameFr = "Taxe pour la forteresse";}
                else if(name === "taxe-1st"){nameFr = "Coussin : objectif supplémentaire, mener une vie paisible";}
                else if(name === "taxe-2nd"){nameFr = "Coussin brodé : objectif supplémentaire, mener une vie divine";}
                else{nameFr = "ERROR";}

                return "<img src=images/ressources/"+name+".png title='"+nameFr+"' width=32px>";
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function definitionOf(name){
                let def;
                if(name === "acacia résimiel"){def = "épineux à la résine odeur de miel";}
                else if(name === "aikin"){def = "ceux qui peuvent faire des actions, ouvriers";}
                else if(name === "bautan"){def = "adorateurs";}
                else if(name === "bouquetin vapolaine"){def = "laine d'une texture vaporeuse";}
                else if(name === "busard casquorne"){def = "rapace diurne qui est l’un des symboles des steppes";}
                else if(name === "centaurée sans-tête"){def = "herbacée annuelle à fleurs bleues tubulées, disposées en capitule, fortement appréciées des bouquetins";}
                else if(name === "farko kalama"){def = "première vague";}
                else if(name === "gerboise à groin"){def = "petit rongeur à grandes pattes postérieures et longue queue";}
                else if(name === "grues à ailerons"){def = "oiseau haut sur pattes ayant une ossature faisant ressortir des ailerons permetant un meilleur vol";}
                else if(name === "guguwa"){def = "déferlante, ouragan";}
                else if(name === "ido"){def = "œil, ici lune";}
                else if(name === "idoflames bariolés"){def = "coléoptère qui peut être tout rond si il est rempli de gaz, ou en forme de croissant de lune sinon";}
                else if(name === "iris poilrosette"){def = "herbacée de pelouse aux pétales jaune et à la présence de poils sur sa rosette basale";}
                else if(name === "kabila"){def = "tribu";}
                else if(name === "Kaifi"){def = "tranchant, fendeur";}
                else if(name === "lièvre étoilé"){def = "pelage nuit tâcheté de blanc";}
                else if(name === "lin abrufil"){def = "arbuste fournissant grâce à ses fibres de quoi faire des cordages et voiles";}
                else if(name === "longmuseau à crinière"){def = "renard à la mâchoire allongée et avec une collerette de fourrure";}
                else if(name === "marmotte quadrops"){def = "rongeur à quatre yeux lui permettant de facilement voir le danger";}
                else if(name === "nassolfière"){def = "mongolfière pourvue d’une nasse pour attraper les créatures volantes";}
                else if(name === "œillet veiné"){def = "plante dont les fleurs sont triées de veines qui semblent pulser et qui servent pour teindre";}
                else if(name === "panthère coloristrate"){def = "félin dont le pelage permet une grande capacité de camouflage";}
                else if(name === "papillon goutte"){def = "chaque apendice caudale de ses ailes a une forme de goutte d'eau qui est entrain de tomber";}
                else if(name === "pottok hexapode à crête"){def = "cheval des steppes à six pattes et une crinière droite";}
                else if(name === "rana"){def = "soleil";}
                else if(name === "renard déonvert"){def = "canidé à la gueule pouvant s’étirer et au poil changeant avec la saison pour être camouflé";}
                else if(name === "sabo"){def = "nouveau, nouvel arrivé";}
                else if(name === "sake"){def = "jeu de société dont le nom signifie : encore";}
                else if(name === "sanglier dorsoplaque"){def = "muni de multiples plaques s'articulant sur son dos";}
                else if(name === "sarewa"){def = "ocarina, flûte";}
                else if(name === "sauterelle milong"){def = "sauterelle ayant un abdomen atrophié";}
                else if(name === "saxaoul rampant"){def = "arbre au tronc tortueux de couleur blanche";}
                else if(name === "sphéricage couronnée"){def = "buisson ovoïde  dépourvu de feuille, excepté sa couronne au sommet";}
                else if(name === "tashi"){def = "départ, voyage, exode dans ce cas";}
                else if(name === "tauran"){def = "étoiles";}
                else if(name === "tehanegh"){def = "entité omniprésente";}
                else if(name === "yack quadkern"){def = "ruminant à quatre cornes dont le poil est utilisé pour du cordage";}
                else if(name === "zuriya mayafi"){def = "littéralement : graine à voile, signifiant une sorte de char à voile";}
                else if(name === "Gragheskr"){def = "entité de la terre représentée par un cobra humanoïde";}
                else if(name === "Tsawol"){def = "entité de la nuit représentée par une fouine humanoïde";}
                else if(name === "Woushafigewa"){def = "entité de l’air représentée par un aigle orné humanoïde";}
                else{name = "! error on "+name+" !";}

                return "<span class=definition_txt title=\""+def+"\">"+name+"</span>";
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            
            function approxRessources(nbOfThisRess){//Balancing
                if(nbOfThisRess === 0){return "<span title=\"Pour plus de précision, faites l’inventaire du lieu dans Carte\" style=\"cursor:help; color:#be7836\">---</span>";}
                else if(nbOfThisRess < 10){return "<span title=\"Pour plus de précision, faites l’inventaire du lieu dans Carte\" style=\"cursor:help; color:#be7836\">très peu</span>";}
                else if(nbOfThisRess < 25){return "<span title=\"Pour plus de précision, faites l’inventaire du lieu dans Carte\" title=\"Pour plus de précision, faites l’inventaire du lieu dans Carte\" style=\"cursor:help; color:#fca048\">modérée</span>";}
                else if(nbOfThisRess < 35){return "<span title=\"Pour plus de précision, faites l’inventaire du lieu dans Carte\" title=\"Pour plus de précision, faites l’inventaire du lieu dans Carte\" style=\"cursor:help; color:#fca048\">beaucoup</span>";}
                else{return "<span title=\"Pour plus de précision, faites l’inventaire du lieu dans Carte\" style=\"cursor:help\">profusion</span>";}
                return nbOfThisRess;
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function isSpotAvailable(nbSpot){
                if(board.spotJ[nbSpot] == board.spotJ[player.localisation]+2){ //2 columns in the right of the player loalisation
                    if(board.tiles[board.spotI[player.localisation]][board.spotJ[player.localisation]+1] == "-" && board.spotI[nbSpot] == board.spotI[player.localisation]){
                        return true;
                    }else if(board.tiles[board.spotI[player.localisation]-1][board.spotJ[player.localisation]+1] == "/" && board.spotI[nbSpot] == board.spotI[player.localisation]-2){
                        return true;
                    }else if(board.tiles[board.spotI[player.localisation]+1][board.spotJ[player.localisation]+1] == "\\" && board.spotI[nbSpot] == board.spotI[player.localisation]+2){
                        return true;
                    }else{
                        return false;
                    }
                }
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function gathering(type, lvl, action){
                let wood = [1,2,3];
                let stone = [1,2,4];
                let food = [2,4];
                let fiber = [4,10];
                if(action == "cost"){
                    if(player.workerAvaible == 0){return false;}
                    else{
                        if(lvl == 0){return true;}
                        else if(type === "wood" && lvl == 1 && axe.quantityAvailable[0] > 0){return true;}
                        else if(type === "wood" && lvl == 2 && axe.quantityAvailable[1] > 0){return true;}
                        else if(type === "stone" && lvl == 1 && pickaxe.quantityAvailable[0] > 0){return true;}
                        else if(type === "stone" && lvl == 2 && pickaxe.quantityAvailable[1] > 0){return true;}
                        else if(type === "food" && lvl == 1 && basket.quantityAvailable[0] > 0){return true;}
                        else if(type === "fiber" && lvl == 1 && basket.quantityAvailable[0] > 0){return true;}
                        else{return false;}
                    }
                }else if(action == "gather"){
                    if(gathering(type, lvl, "cost")){//isTrue
                        player.workerAvaible --;
                        if(type === "wood"){
                            if(lvl === 1){axe.quantityAvailable[0]--;}
                            else if(lvl === 2){axe.quantityAvailable[1]--;}
                            player.woodNextDay += gathering(type, lvl, "gain");
                        }else if(type === "stone"){
                            if(lvl === 1){pickaxe.quantityAvailable[0]--;}
                            else if(lvl === 2){pickaxe.quantityAvailable[1]--;}
                            player.stoneNextDay += gathering(type, lvl, "gain");
                        }
                        else if(type === "food"){
                            if(lvl === 1){basket.quantityAvailable[0]--;}
                            player.foodNextDay += gathering(type, lvl, "gain");
                        }else if(type === "fiber"){
                            if(lvl === 1){basket.quantityAvailable[0]--;}
                            player.fiberNextDay += gathering(type, lvl, "gain");
                        }
                        updateStat(player.localisation);
                        update("ressources");
                        update("gather");
                    }
                }else{//gain
                    if(type === "wood"){return wood[lvl];}
                    else if(type === "stone"){return stone[lvl];}
                    else if(type === "food"){return food[lvl];}
                    else if(type === "fiber"){return fiber[lvl];}
                }
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function build(nameOfBuilding, i){
                player.wood -= buildings.woodCost[i];
                player.plank -= buildings.plankCost[i];
                player.stone -= buildings.stoneCost[i];
                player.ore -= buildings.oreCost[i];
                player.fiber -= buildings.fiberCost[i];
                player.sail -= buildings.sailCost[i];
                player.workerAvaible --;
                if(nameOfBuilding === "saw-windmill" || nameOfBuilding == "furnace-windmill" || nameOfBuilding == "loom-windmill"){
                    let p = buildings.name.indexOf(nameOfBuilding.match("([a-z]*)")[0]);
                    buildings.quantityTotal[p] --;
                    if(buildings.quantityAvailable[p] > 0){buildings.quantityAvailable[p] = 0;}
                }
                buildings.quantityTotal[buildings.name.indexOf(nameOfBuilding)] ++;
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function stockManagement(type){
                //Be sure to be the same as buildings.weight //Balancing
                let woodWeight = 8;
                let plankWeight = 2;
                let stoneWeight = 6;
                let oreWeight = 2;
                let fiberWeight = 0;
                let sailWeight = 3;
                let foodWeight = 1;
                //Balancing
                let wagonLight = -200;
                let wagonLargeLight = -400;
                let wagonDivin = -1000;
                let weightsum = 0;
                let lightsum = 0;
                let interweightsum = 0;
                let txt = "<table class=table_stock><tr><th>Nom</th><th>Quantité</th><th>Brûler</th><th>Poids</th><th>Total</th><th>Valeur</th><th>Total</th>";
                txt += "</tr>";
                //
                txt += "<tr><th colspan=7>Ressources</th></tr>";
                let mRessName = ["Bois", "Planche", "Roche", "Minerai", "Fibre", "Voile", "Nourriture"];
                let mRessWeight = [woodWeight, plankWeight, stoneWeight, oreWeight, fiberWeight, sailWeight, foodWeight];
                let mRessPlayer = [player.wood, player.plank, player.stone, player.ore, player.fiber, player.sail, player.food];
                for(i=0; i<mRessName.length; i++){
                    txt += "<tr><td>"+mRessName[i]+"</td><td>"+ mRessPlayer[i] +"</td><td>";
                    if(mRessPlayer[i] > 0){txt += sacrifice(i);}
                    txt += "</td><td>"+ mRessWeight[i] +"</td><td>"+ (mRessWeight[i]*mRessPlayer[i]) +"</td><td>"+howManyCredits("valeur"+mRessName[i])+"</td><td>"+howManyCredits(mRessName[i])+"</td></tr>";
                    interweightsum += mRessWeight[i]*mRessPlayer[i];
                }
                txt += "<tr><td colspan=3>Total</td><td>"+img("weight")+"</td><td class=important_txt>"+interweightsum+"</td><td>"+img("taxe-base")+"</td><td class=important_txt>"+howManyCredits("allRess")+"</td></tr>";
                weightsum += interweightsum;
                interweightsum = 0;
                //
                txt += "<tr><th colspan=7>Outils</th></tr>";
                if(axe.quantityTotal[0] > 0){
                    txt += "<tr><td>Hache en bois</td><td>"+ axe.quantityTotal[0] +"</td><td>"+sacrifice(["axe.quantityAvailable[0]","axe.quantityTotal[0]"])+"</td><td>"+ (woodWeight+plankWeight) +"</td><td>"+ ((woodWeight+plankWeight)*axe.quantityTotal[0]) +"</td><td>"+howManyCredits("axe-wood")+"</td><td>"+(howManyCredits("axe-wood")*axe.quantityTotal[0])+"</td></tr>";
                    interweightsum += ((woodWeight+plankWeight)*axe.quantityTotal[0]);
                }
                if(axe.quantityTotal[1] > 0){
                    txt += "<tr><td>Hache en métal</td><td>"+ axe.quantityTotal[1] +"</td><td>"+sacrifice(["axe.quantityAvailable[1]","axe.quantityTotal[1]"])+"</td><td>"+ (oreWeight+plankWeight) +"</td><td>"+ ((oreWeight+plankWeight)*axe.quantityTotal[1]) +"</td><td>"+howManyCredits("axe-ore")+"</td><td>"+(howManyCredits("axe-ore")*axe.quantityTotal[1])+"</td></tr>";
                    interweightsum += ((oreWeight+plankWeight)*axe.quantityTotal[1]);
                }
                if(pickaxe.quantityTotal[0] > 0){
                    txt += "<tr><td>Pioche en bois</td><td>"+ pickaxe.quantityTotal[0] +"</td><td>"+sacrifice(["pickaxe.quantityAvailable[0]","pickaxe.quantityTotal[0]"])+"</td><td>"+ (woodWeight+plankWeight) +"</td><td>"+ ((woodWeight+plankWeight)*pickaxe.quantityTotal[0]) +"</td><td>"+howManyCredits("pickaxe-wood")+"</td><td>"+(howManyCredits("pickaxe-wood")*pickaxe.quantityTotal[0])+"</td></tr>";
                    interweightsum += ((woodWeight+plankWeight)*pickaxe.quantityTotal[0]);
                }
                if(pickaxe.quantityTotal[1] > 0){
                    txt += "<tr><td>Pioche en métal</td><td>"+ pickaxe.quantityTotal[1] +"</td><td>"+sacrifice(["pickaxe.quantityAvailable[1]","pickaxe.quantityTotal[1]"])+"</td><td>"+ (oreWeight+plankWeight) +"</td><td>"+ ((oreWeight+plankWeight)*pickaxe.quantityTotal[1]) +"</td><td>"+howManyCredits("pickaxe-ore")+"</td><td>"+(howManyCredits("pickaxe-ore")*pickaxe.quantityTotal[1])+"</td></tr>";
                    interweightsum += ((oreWeight+plankWeight)*pickaxe.quantityTotal[1]);
                }
                if(basket.quantityTotal[0] > 0){
                    txt += "<tr><td>Panier</td><td>"+ basket.quantityTotal[0] +"</td><td>"+sacrifice(["basket.quantityAvailable[0]","basket.quantityTotal[0]"])+"</td><td>"+ (plankWeight*4) +"</td><td>"+ ((plankWeight*4)*basket.quantityTotal[0]) +"</td><td>"+howManyCredits("basket")+"</td><td>"+(howManyCredits("basket")*basket.quantityTotal[0])+"</td></tr>";
                    interweightsum += ((plankWeight*3)*basket.quantityTotal[0]);
                }
                txt += "<tr><td colspan=3>Total</td><td>"+img("weight")+"</td><td class=important_txt>"+interweightsum+"</td><td>"+img("taxe-base")+"</td><td class=important_txt>"+howManyCredits("allTools")+"</td></tr>";
                weightsum += interweightsum;
                interweightsum = 0;
                //
                txt += "<tr><th colspan=7>Structures</th></tr>";
                for(i=0; i<buildings.name.length; i++){
                    if(buildings.quantityTotal[i] > 0 && (buildings.name[i] != "wagon" && buildings.name[i] != "wagon-large")){
                        txt += "<tr><td>"+buildings.nameFr[i]+"</td><td>"+buildings.quantityTotal[i]+"</td><td>"+sacrifice(["buildings.quantityAvailable["+i+"]","buildings.quantityTotal["+i+"]"])+"</td>";
                        if(buildings.name[i] === "saw-windmill" || buildings.name[i] === "furnace-windmill" || buildings.name[i] === "loom-windmill"){
                            let bweight = buildings.weight[buildings.name.indexOf(buildings.name[i].match("([a-z]*)")[0])]+buildings.weight[i];
                            txt += "<td>"+bweight+"</td><td>"+(bweight*buildings.quantityTotal[i])+"</td><td>"+howManyCredits(i)+"</td><td>"+(howManyCredits(i)*buildings.quantityTotal[i])+"</td></tr>";
                            interweightsum += bweight*buildings.quantityTotal[i];
                        }else{
                            txt += "<td>"+buildings.weight[i]+"</td><td>"+(buildings.weight[i]*buildings.quantityTotal[i])+"</td><td>"+howManyCredits(i)+"</td><td>"+(howManyCredits(i)*buildings.quantityTotal[i])+"</td></tr>";
                            interweightsum += buildings.weight[i]*buildings.quantityTotal[i];
                        }
                    }
                }
                txt += "<tr><td colspan=3>Total</td><td>"+img("weight")+"</td><td class=important_txt>"+interweightsum+"</td><td>"+img("taxe-base")+"</td><td class=important_txt>"+howManyCredits("allStr")+"</td></tr>";
                weightsum += interweightsum;
                interweightsum = 0;
                //
                txt += "<tr><th colspan=7>Transports</th></tr>";
                for(i of [buildings.name.indexOf("wagon"), buildings.name.indexOf("wagon-large")]){
                    if(buildings.quantityTotal[i] > 0){
                        let valueLight;
                        if(i === buildings.name.indexOf("wagon")){valueLight = wagonLight;}
                        else{valueLight = wagonLargeLight;}
                        txt += "<tr><td>"+buildings.nameFr[i]+"</td><td>"+buildings.quantityTotal[i]+"</td><td></td><td>"+valueLight+"</td><td>"+valueLight*buildings.quantityTotal[i]+"</td><td>"+howManyCredits(i)+"</td><td>"+(howManyCredits(i)*buildings.quantityTotal[i])+"</td></tr>";
                        lightsum += valueLight*buildings.quantityTotal[i];
                    }
                    if(player.sacrificeMade === "done"){
                        txt += "<tr><td>Navire divin</td><td>1</td><td>---</td><td>"+wagonDivin+"</td><td>"+wagonDivin+"</td><td></td><td></td></tr>";
                        lightsum += wagonDivin;
                    }
                }
                txt += "<tr><td colspan=3>Total</td><td>"+img("weight")+"</td><td class=important_txt>"+lightsum+"</td><td>"+img("taxe-base")+"</td><td class=important_txt>"+howManyCredits("allTrans")+"</td></tr>";
                //
                let totalsum = weightsum + lightsum;
                txt += "<tr><th colspan=7>Final : ";
                if(totalsum <= 0){txt += "espace libre";}
                else{txt += "manque de place";}
                txt += "</th></tr>";
                txt += "<tr><td colspan=3></td><td>"+img("weight")+"</td><td>";
                if(totalsum <= 0){txt += totalsum;}
                else{txt += "<span class=warning>"+totalsum+"</span>";}
                txt += "</td><td>"+img("taxe-base")+"</td><td class=important_txt>"+howManyCredits("all")+"</td></tr>";
                txt += "</table>";
                //
                if(type === "stock"){return txt;}
                else if(type === "lightsum"){return lightsum;}
                else{return weightsum;}
                //
                function sacrifice(toRemove){
                    let maction;
                    if(Number.isInteger(toRemove)){
                        if(toRemove === 0){maction = "player.wood --;";}
                        else if(toRemove === 1){maction = "player.plank --;";}
                        else if(toRemove === 2){maction = "player.stone --;";}
                        else if(toRemove === 3){maction = "player.ore --;";}
                        else if(toRemove === 4){maction = "player.fiber --;";}
                        else if(toRemove === 5){maction = "player.sail --;";}
                        else{maction = "player.food --;";}
                    }
                    else{//array [available, total]
                        maction = toRemove[1]+" --; "+toRemove[0]+" = "+toRemove[1]+";";
                    }
                    return "<img src=images/ressources/burn.png title=\"Sacrifier la ressource\" class=burn onclick='"+maction+"player.sacrificeMade ++; update(\"ressources\"); update(\"stock\");' width=32px>";
                }
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function playSake(posP, posA, sticks, selected, roll, keep){
                let sticksFaces = [[0,0,1,3], [0,2,2,4], [0,2,2,4], [0,2,3,6]];//Balancing
                let backColor = ["#977b4c", "#5a372a", "#5a372a", "#2d1b15"];
                let maxMove = Math.max.apply(null, sticksFaces[0])+Math.max.apply(null, sticksFaces[1])+Math.max.apply(null, sticksFaces[2])+Math.max.apply(null, sticksFaces[3]);
                let insideDiv = "";

                if(typeof posP == 'undefined'){posP = 0; posA = 0; selected = [false, false, false, false]; insideDiv = "<p>Le but du jeu est d’arriver sur, ou de dépasser la <span class=important_txt>case 100</span> du plateau de jeu avant son adversaire. Tous les joueurs commencent sur la case zéro.<br>Au début de son tour, le joueur <span class=important_txt>lance les 4 baguettes</span>. Si à n’importe quel moment le joueur obtient avec les baguettes <span class=important_txt>3 faces vierges : il passe</span> son tour, sans avancer. Si ce n’est pas le cas, il peut décider de <span class=important_txt>garder</span> ce lancé et d’avancer d’autant de cases qu’il y a de points visibles sur les baguettes, ou de <span class=important_txt>relancer</span> tout ou partie des baguettes non vierges. C’est un principe de stop ou encore, d’où le nom du jeu.<br>Une fois que le joueur a gardé et avancé son pion, ou a dû passer son tour sans bouger, c’est au tour de son adversaire de jouer.<br>Le joueur peut à tout moment de son tour prendre une baguette en main pour regarder quelles sont les quatre faces de celle-ci.</p>";}//First time
                else if(typeof sticks == 'undefined'){sticks = [];}//Second time

                if(roll){
                    for(i=0; i<4; i++){
                        if(selected[i]){sticks[i] = sticksFaces[i][parseInt(Math.random()*4)];}
                    }
                    roll = false;
                    selected = [false, false, false, false];
                }

                //Road
                insideDiv += "<p style=\"text-align:center;color:#45332d;\">";
                for(i=0; i<=Math.max(100, posP, posA); i++){
                    if(i === posP && i === posA){insideDiv += "<span class=sake_both>";}
                    else if(i === posP){insideDiv += "<span class=sake_posP>";}
                    else if(i === posA){insideDiv += "<span class=sake_posA>";}
                    else{insideDiv += "<span>";}
                    if(i%10 === 0){insideDiv += i+" ";}
                    else if(i === 100-maxMove){insideDiv += "▓ ";}
                    else{insideDiv += "█ ";}
                    insideDiv += "</span>";
                }
                insideDiv += "</p><p style=\"text-align:center;\">";
                //Buttons
                if(typeof sticks == 'undefined' || keep){
                    if(keep && posP < 100){
                        let moveA = sticks[0]+sticks[1]+sticks[2]+sticks[3];
                        if(moveA === Math.max.apply(null, sticks)){moveA = 0;}
                        else{moveA += 1;//Balancing
                            if(moveA > maxMove){moveA = maxMove;}}
                        posA += moveA;
                        insideDiv += "L'adversaire lance : ";
                        if(moveA === 0){insideDiv += "et passe. Ouf !";}
                        else{insideDiv += moveA;}
                        insideDiv += "<br>";
                        keep = false;
                    }
                    if(posP < 100 && posA < 100){
                        insideDiv += "<button onclick='playSake("+posP+","+posA+", undefined, [true,true,true,true], true, false);'>Lancer les baguettes</button>";
                    }
                    else{
                        if(posP > posA){insideDiv += "Bravo, c'est gagné !";}
                        else if(posP < posA){insideDiv += "Mince, c'est perdu. Revanche ?";}
                        else{insideDiv += "Égalité parfaite : il faut vous départager !";}
                        insideDiv += "<br><button onclick='playSake(0,0, undefined, [true,true,true,true], true, false);'>Re-lancer les baguettes</button> <button onclick='player.needToChoose=false; update(\"map\");'>Arrêter</button>";
                    } 
                }else{
                    let countFail = 0;
                    for(i=0; i<4; i++){
                        insideDiv += "<button title=\""+sticksFaces[i]+"\" style=\"background-color:"+backColor[i]+";";
                        if(selected[i]){insideDiv += "border:2px solid orange;";}
                        insideDiv += "\" onclick='playSake("+posP+","+posA+",["+sticks+"],[";
                        for(j=0; j<4; j++){//selected
                            if(i===j && selected[j] === true){insideDiv += "false";}
                            else if(i===j && selected[j] === false){insideDiv += "true";}
                            else{insideDiv += selected[j];}
                            if(j<3){insideDiv += ",";}
                        }
                        insideDiv += "],"+roll+","+keep+");' ";
                        if(sticks[i] === 0){insideDiv += "class=unclicable DISABLED";}
                        insideDiv += ">";
                        //Txt inside button
                        for(j=0; j<sticks[i]; j++){insideDiv += "■";}
                        for(j=0; j<(Math.max.apply(null, sticksFaces[i])-sticks[i]) ;j++){insideDiv += "<span style=\"color:"+backColor[i]+";\">■</span>";}
                        if(sticks[i] === 0){countFail ++;}
                        insideDiv += "</button> ";
                    }
                    if(countFail >= 3){
                        insideDiv += "</p><p style=\"text-align:center;\" onclick='playSake("+posP+","+posA+", [], [true,true,true,true], true, true);'><button>Passer</button>";
                    }else{
                        insideDiv += "</p><p style=\"text-align:center;\"><button onclick='playSake("+posP+","+posA+",["+sticks+"],["+selected+"], true, false);'>Relancer</button> ";
                        insideDiv += "<button onclick='playSake("+(posP+sticks[0]+sticks[1]+sticks[2]+sticks[3])+","+posA+", [], [true,true,true,true], true, true);'>Garder</button>";
                    }
                }
                insideDiv += "</p>";

                document.getElementById('main_div').innerHTML = insideDiv;
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function fight(){
                let crossbow = buildings.quantityTotal[buildings.name.indexOf("crossbow")];
                let difficultyLevel;//Balancing
                if(board.spotJ[player.localisation] < 7){difficultyLevel = 1;}
                else if(board.spotJ[player.localisation] < 13){difficultyLevel = 4;}
                else{difficultyLevel = 7;}

                let nbPirates = buildings.quantityTotal[buildings.name.indexOf("beacon")]*2 + difficultyLevel + parseInt(Math.random()*3);//Balancing
                let nbPiratesStart = nbPirates;
                let insideDiv = "<p>";
                if(nbPirates >= 2){insideDiv += "Ils étaient <span class=important_txt>"+nbPirates+" pirates enrubanés</span>";}
                else{insideDiv += "C'était <span class=important_txt>un pirate isolé</span>";}
                insideDiv += ", armes au poing. Grâce à votre connaissance du terrain vous avez pu en premier ";
                if(nbPirates >= 2){insideDiv += "leur";}else{insideDiv += "lui";}
                insideDiv += " infliger de lourdes pertes : <span class=important_txt>";

                if(crossbow > 0){
                    if(crossbow > nbPirates){insideDiv += nbPirates;}else{insideDiv += crossbow;}
                    if(crossbow >= 2 && nbPirates >= 2){insideDiv += " pirates</span> sont tombés grâce aux cranequins tripode";}
                    else{insideDiv += " pirate</span> est tombé grâce au cranequin tripode";}
                    nbPirates -= crossbow;
                    if(nbPirates > 0 && player.workerAvaible >= 2){insideDiv += " et <span class=important_txt>";}
                }
                if(nbPirates > 0){
                    if(parseInt(player.workerAvaible/2) > nbPirates){insideDiv += nbPirates}else{insideDiv += parseInt(player.workerAvaible/2);}
                    if(parseInt(player.workerAvaible/2) >= 2 && nbPirates >= 2){insideDiv += " pirates</span> sont morts";}
                    else{insideDiv += " pirate</span> est mort";}
                    insideDiv += " sous vos coups d’armes improvisées";
                    nbPirates -= parseInt(player.workerAvaible/2);
                }
                insideDiv += ". ";
                //Counterattack
                if(nbPirates > 0){
                    let throat = 0;
                    let hurt = 0;
                    if(nbPirates >= 2){insideDiv += "Ils ont riposés";}else{insideDiv += "Le dernie pirate a riposté";}
                    if(buildings.quantityTotal[buildings.name.indexOf("fortification")] > 0){
                        insideDiv += ", mais heureusement ralenti par <span class=important_txt>";
                        if(buildings.quantityTotal[buildings.name.indexOf("fortification")] >= 2){
                            insideDiv += "les fortifications";}
                        else{insideDiv += "la fortification";}
                        insideDiv += "</span> (-"+Math.min(nbPirates, buildings.quantityTotal[buildings.name.indexOf("fortification")])+" "+buildings.img("fortification")+"),";
                    }
                    for(i=0; i<(nbPirates - buildings.quantityTotal[buildings.name.indexOf("fortification")]); i++){
                        let randomise = Math.random();
                        if(randomise > 0.7){hurt ++;}//Balancing
                        else{throat ++;}
                    }
                    buildings.quantityTotal[buildings.name.indexOf("fortification")] -= nbPirates;
                    if(buildings.quantityTotal[buildings.name.indexOf("fortification")] < 0){buildings.quantityTotal[buildings.name.indexOf("fortification")] = 0;}
                    throat = Math.min(throat, player.workerTotal);
                    if(throat > 0){
                        insideDiv += " en <span class=important_txt>égorgeant "+throat+"</span> des tiens";
                        player.workerTotal -= throat; player.workerAvaible -= throat;
                        if(player.workerTotal > 0 && hurt > 0){insideDiv += " et";}
                    }
                    hurt = Math.min(hurt, player.workerAvaible);
                    if(hurt > 0){
                      insideDiv += " en <span class=important_txt>blessant "+hurt+"</span> des tiens qui ";
                        player.workerAvaible -= hurt;
                        if(player.workerAvaible < 0){player.workerTotal += player.workerAvaible; player.workerAvaible = 0;}
                        if(hurt >= 2){insideDiv += "ont réussis";}else{insideDiv += "a réussi";}
                        insideDiv += " à se protéger du coup mortel";  
                    }
                    if(throat === 0 && hurt === 0){//fortification block all
                        insideDiv += "aucune attaque de ";
                        if(nbPirates >= 2){insideDiv += "leur";}
                        else{insideDiv += "sa";}
                        insideDiv += " part n'a pu être portée";
                    }
                    insideDiv += ". ";
                    if(player.workerTotal > 0){
                        insideDiv += "Le combat a continué jusqu’à la mort.";
                        while(player.workerTotal > 0 && nbPirates > 0){
                            nbPirates -= crossbow;
                            nbPirates -= parseInt(player.workerAvaible /2);
                            if(nbPirates > 0){
                                let throat = 0;
                                let hurt = 0;
                                for(i=0; i<nbPirates; i++){
                                    let randomise = Math.random();
                                    if(randomise > 0.7){hurt ++;}
                                    else{throat ++;}
                                }
                                throat = Math.min(throat, player.workerTotal);
                                hurt = Math.min(hurt, player.workerAvaible);
                                player.workerTotal -= throat; player.workerAvaible -= throat;
                                player.workerAvaible -= hurt; player.wounded += hurt;
                                if(player.workerAvaible < 0){player.workerTotal += player.workerAvaible; player.workerAvaible = 0;}
                            }
                        }
                    }
                }
                if(player.workerTotal > 0){
                    insideDiv += "<br>Après avoir fait le nécessaire pour ceux qui t’accompagnent, tu fouilles ";
                    if(nbPiratesStart >= 2){insideDiv += "leur ";}else{insideDiv += "son ";}
                    insideDiv += definitionOf("zuriya mayafi") + " et trouve en récompense :<br>";
                    let rewardPirate = [parseInt(Math.random()*3)+1*difficultyLevel, parseInt(Math.random()*5)+2*difficultyLevel, parseInt(Math.random()*3)+1*difficultyLevel, parseInt(Math.random()*4)+1*difficultyLevel, parseInt(Math.random()*5)+2*difficultyLevel, parseInt(Math.random()*3)+1*difficultyLevel, parseInt(Math.random()*4)+1*difficultyLevel];//Balancing
                    insideDiv += "+"+rewardPirate[0]+" "+img("wood")+" "+"+"+rewardPirate[1]+" "+img("plank")+" "+"+"+rewardPirate[2]+" "+img("stone")+" "+"+"+rewardPirate[3]+" "+img("ore")+" "+"+"+rewardPirate[4]+" "+img("fiber")+" "+"+"+rewardPirate[5]+" "+img("sail")+" "+"+"+rewardPirate[6]+" "+img("food");
                    insideDiv += "</p>";
                    player.wood += rewardPirate[0]; player.plank += rewardPirate[1]; player.stone += rewardPirate[2]; player.ore += rewardPirate[3]; player.fiber += rewardPirate[4]; player.sail += rewardPirate[5]; player.food += rewardPirate[6];
                    update("ressources");
                }else{
                    player.needToChoose = true; update("dashboard"); player.workerTotal = 0; update("ressources"); insideDiv += "<p style=\"text-align:center;\"><button onclick='update(\"end\");'>Mort</button></p>";
                }

                document.getElementById('main_div').innerHTML = insideDiv;
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function merchandise(credits){
                if(typeof credits == 'undefined'){credits = 0;}
                let mPriceSell = [4, 1, 3, 2, 1, 10, 3];//Balancing
                let mPriceBuy = [6, 2, 4, 3, 2, 14, 4];//Balancing
                let insideDiv = "<p>Le marchand te propose de faire un échange de ressources à bon prix. Du haut de son chariot à voile bien rempli, il affirme que chez lui ce n’est pas cher, qu’il faut en profiter.</p>";
                insideDiv += "<div style=\"text-align:center;\"><table id=merchandise><tr><th colspan=2>Ressources personnelles</th><th rowspan=2>Monnaie<br>d'échange</th><th colspan=2>Ressources du marchand</th></tr><tr><th>Ressource</th><th>Vendre</th><th>Acheter</th><th>Ressource</th></tr>";

                let ressourcePlayer = [player.wood, player.plank, player.stone, player.ore, player.fiber, player.sail, player.food];
                for(i=0; i<ressourcesName.length; i++){
                    insideDiv += "<tr><td>"+ressourcePlayer[i]+" "+img(ressourcesName[i])+"</td><td><button onclick='player."+ressourcesName[i]+" --; update(\"ressources\"); merchandise("+(credits+mPriceSell[i])+");'";
                    if(ressourcePlayer[i] === 0){insideDiv += " class=unclicable DISABLED";}
                    insideDiv += ">+"+mPriceSell[i]+"</button></td>";
                    if(i === 0){insideDiv += "<td rowspan=7>"+credits+"</td>";}
                    insideDiv += "<td><button onclick='player."+ressourcesName[i]+" ++; update(\"ressources\"); merchandise("+(credits-mPriceBuy[i])+");'";
                    if(credits < mPriceBuy[i]){insideDiv += " class=unclicable DISABLED";}
                    insideDiv += ">-"+mPriceBuy[i]+"</button></td><td>"+img(ressourcesName[i])+"</td></tr>";
                }

                insideDiv += "</table></div><p style=\"text-align:center;\"><button onclick='player.needToChoose = false; update(\"map\");'>Quitter le marchand</button></p><p><details><summary>Structures</summary>";
                for(i=0; i<buildings.name.length; i++){
                    if(i===3){insideDiv += "------ Affinage ------<br>";}
                    else if(i===7){insideDiv += "------ Transport ------<br>";}
                    else if(i===10){insideDiv += "------ Autre ------<br>";}
                    insideDiv += buildings.img(i)+" "+buildings.nameFr[i]+" x"+buildings.quantityTotal[i]+ " --- Coût :";
                    if(buildings.woodCost[i] > 0){insideDiv += " " +buildings.woodCost[i]+ " "+img("wood");}
                    if(buildings.plankCost[i] > 0){insideDiv += " + " +buildings.plankCost[i]+ " "+img("plank");}
                    if(buildings.stoneCost[i] > 0){insideDiv += " + " +buildings.stoneCost[i]+ " "+img("stone");}
                    if(buildings.oreCost[i] > 0){insideDiv += " + " +buildings.oreCost[i]+ " "+img("ore");}
                    if(buildings.fiberCost[i] > 0){insideDiv += " + " +buildings.fiberCost[i]+ " "+img("fiber");}
                    if(buildings.sailCost[i] > 0){insideDiv += " + " +buildings.sailCost[i]+ " "+img("sail");}
                    insideDiv += "<br>";
                    }
                insideDiv += "</details>";

                document.getElementById('main_div').innerHTML = insideDiv;
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function ally(){
                let nbAllies = parseInt(Math.random()*buildings.quantityTotal[buildings.name.indexOf("beacon")]);//Balancing
                if(nbAllies <= 0){nbAllies = 1;}
                player.workerAvaible += nbAllies;
                player.workerTotal += nbAllies;
                update("ressources");
                let randomGenre = parseInt(Math.random()*2);
                let subject;
                if(nbAllies < 2 && randomGenre === 0){subject = "elle";}
                else if(nbAllies < 2 && randomGenre === 1){subject = "il";}
                else if(nbAllies >= 2 && randomGenre === 0){subject = "elles";}
                else{subject = "ils";}
                let insideDiv = "<p>" + subject.charAt(0).toUpperCase() + subject.slice(1) + " décen";
                if(nbAllies >= 2){insideDiv += "dent";}else{insideDiv += "t";}
                insideDiv += " de ";
                if(nbAllies >= 2){insideDiv += "leur ";}else{insideDiv += "son ";}
                insideDiv += definitionOf("zuriya mayafi") + " en agitant une étoffe blanche.<br>Après avoir raconté les péripéties qui ";
                if(nbAllies >= 2){insideDiv += "leur";}else{insideDiv += "lui";}
                insideDiv += " sont arrivés, "+subject+" demande";
                if(nbAllies >= 2){insideDiv += "nt";}
                insideDiv += " à rejoindre ton semblant de "+definitionOf("kabila")+" pour le reste du "+definitionOf("tashi")+".<br>";
                for(i=0; i<nbAllies; i++){insideDiv += img("worker");}
                insideDiv += "</p>";
                document.getElementById('main_div').innerHTML = insideDiv;
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function howManyCredits(pRess){
                let mPrice = [4, 1, 3, 2, 1, 10, 3];//Balancing
                if(pRess === "valeurBois"){return mPrice[0];}
                else if(pRess === "valeurPlanche"){return mPrice[1];}
                else if(pRess === "valeurRoche"){return mPrice[2];}
                else if(pRess === "valeurMinerai"){return mPrice[3];}
                else if(pRess === "valeurFibre"){return mPrice[4];}
                else if(pRess === "valeurVoile"){return mPrice[5];}
                else if(pRess === "valeurNourriture"){return mPrice[6];}
                else if(pRess === "Bois"){return mPrice[0]*player.wood;}
                else if(pRess === "Planche"){return mPrice[1]*player.plank;}
                else if(pRess === "Roche"){return mPrice[2]*player.stone;}
                else if(pRess === "Minerai"){return mPrice[3]*player.ore;}
                else if(pRess === "Fibre"){return mPrice[4]*player.fiber;}
                else if(pRess === "Voile"){return mPrice[5]*player.sail;}
                else if(pRess === "Nourriture"){return mPrice[6]*player.food;}
                else if(pRess === "allRess"){
                    return player.wood*mPrice[0]+player.plank*mPrice[1]+player.stone*mPrice[2]+player.ore*mPrice[3]+player.fiber*mPrice[4]+player.sail*mPrice[5]+player.food*mPrice[6];
                }else if(pRess === "axe-wood"){
                    return mPrice[1]+mPrice[0];
                }else if(pRess === "axe-ore"){
                    return mPrice[1]+mPrice[3];
                }else if(pRess === "pickaxe-wood"){
                    return mPrice[1]+mPrice[0];
                }else if(pRess === "pickaxe-ore"){
                    return mPrice[1]+mPrice[3];
                }else if(pRess === "basket"){
                    return mPrice[1]*3;
                }else if(pRess === "allTools"){
                    return howManyCredits("axe-wood")*axe.quantityTotal[0]+howManyCredits("axe-ore")*axe.quantityTotal[1]+howManyCredits("pickaxe-wood")*pickaxe.quantityTotal[0]+howManyCredits("pickaxe-ore")*pickaxe.quantityTotal[1]+howManyCredits("basket")*basket.quantityTotal[0];
                }else if(pRess === "allStr" || pRess === "allTrans"){
                    let sum = 0;
                    let bVal = [];
                    if(pRess === "allStr"){
                        for(i=0; i<buildings.name.length; i++){if(buildings.name[i] !== "wagon" && buildings.name[i] !== "wagon-large"){bVal.push(i);}}
                    }else{
                        for(i=0; i<buildings.name.length; i++){if(buildings.name[i] === "wagon" || buildings.name[i] === "wagon-large"){bVal.push(i);}}
                    }
                    for(i of bVal){
                        if(buildings.quantityTotal[i] > 0){sum += howManyCredits(i)*buildings.quantityTotal[i];}
                    }
                    return sum;
                }else if(pRess === "all"){
                    return (howManyCredits("allRess")+howManyCredits("allTools")+howManyCredits("allStr")+howManyCredits("allTrans"));
                }else if (Number.isInteger(pRess)){//buildings
                    let windmill = 0;
                    if(buildings.name[pRess] === "saw-windmill" || buildings.name[pRess] === "furnace-windmill" || buildings.name[pRess] === "loom-windmill"){
                        let mRess = buildings.name.indexOf(buildings.name[pRess].match("([a-z]*)")[0]);
                        windmill = buildings.woodCost[mRess]*mPrice[0]+buildings.plankCost[mRess]*mPrice[1]+buildings.stoneCost[mRess]*mPrice[2]+buildings.oreCost[mRess]*mPrice[3]+buildings.fiberCost[mRess]*mPrice[4]+buildings.sailCost[mRess]*mPrice[5];
                    }
                    return windmill+buildings.woodCost[pRess]*mPrice[0]+buildings.plankCost[pRess]*mPrice[1]+buildings.stoneCost[pRess]*mPrice[2]+buildings.oreCost[pRess]*mPrice[3]+buildings.fiberCost[pRess]*mPrice[4]+buildings.sailCost[pRess]*mPrice[5];
                }
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            
            function nextDay(){
                //Gather
                if(player.woodNextDay > board.woodAvaible[player.localisation]){player.woodNextDay = board.woodAvaible[player.localisation];}
                player.wood += player.woodNextDay;
                board.woodAvaible[player.localisation] -= player.woodNextDay;
                player.woodNextDay = 0;

                if(player.stoneNextDay > board.stoneAvaible[player.localisation]){player.stoneNextDay = board.stoneAvaible[player.localisation];}
                player.stone += player.stoneNextDay;
                board.stoneAvaible[player.localisation] -= player.stoneNextDay;
                player.stoneNextDay = 0;

                if(player.fiberNextDay > board.fiberAvaible[player.localisation]){player.fiberNextDay = board.fiberAvaible[player.localisation];}
                player.fiber += player.fiberNextDay;
                board.fiberAvaible[player.localisation] -= player.fiberNextDay;
                player.fiberNextDay = 0;

                if(player.foodNextDay > board.foodAvaible[player.localisation]){player.foodNextDay = board.foodAvaible[player.localisation];}
                player.food += player.foodNextDay;
                board.foodAvaible[player.localisation] -= player.foodNextDay;
                player.foodNextDay = 0;
                player.food += zepplin;
                
                //Days before storm
                if(board.spotJ[player.localisation] === 18){update("end");}//Win
                else if(player.daysBeforeStorm <= 0){player.needToChoose = true; updateStat(player.localisation); update("end");}//Lose
                else if(player.workerTotal <= 0){player.needToChoose = true; updateStat(player.localisation); update("end");}//Lose
                else{
                    //Nutrition
                    player.food -= player.workerTotal;
                    if(player.food < 0){player.needToChoose = true; updateStat(player.localisation); update("end");}//Lose
                    else{
                        //Workers
                        for(i=0; i<player.wounded; i++){
                            if(Math.random() < 0.5){player.wounded --;}
                        }
                        player.workerAvaible = player.workerTotal - player.wounded;

                        //Days
                        player.daysBeforeStorm --;

                        //Tools available
                        axe.resetQuantity();
                        axe.durabilityAvailable = 0;
                        pickaxe.resetQuantity();
                        basket.resetQuantity();

                        //Buildings available
                        for(i=0; i<buildings.name.length; i++){
                            buildings.quantityAvailable[i] = buildings.quantityTotal[i];
                            buildings.durabilityAvailable[i] = 0;
                        }

                        //Update HUD
                        update("ressources");
                        player.needToChoose = true;
                        update("dashboard");
                        updateStat(player.localisation);
                        update("night");
                        
                    }
                }
            }
        </script>

<!--//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->

    </head>
    <nav id=nav_div>
        ᨏᨊᨓ <span style="font-size: 2em">Tashi</span> ᨓᨊᨏ
    </nav>
<div id="ressources_div">
    <!---->
</div>
<div style="display: flex;">
    <div id="dashboard_div" style="flex: 1;">
        <!---->
    </div>

    <div id="main_div" style="flex: 2;">
        <p class="dialogue_p">C’est toi qui avais décidé d’installer la <span class=definition_txt title="tribu">kabila</span> à l’écart des <span class=definition_txt title="ancêtres">magabatan</span>, plus loin dans les steppes, dans un espace qui te semblait pourtant protégé du vent. Un lieu où les ressources paraissaient moins rares, où la nature était plus sauvage, les éléments plus fougueux, un lieu où le vent soufflait de façon plus pur sur le visage.<br>C’est toi qui avais décidé que la <span class=definition_txt title="tribu">kabila</span> resterait sur place lors de la <span class=definition_txt title="première vague">farko kalama</span>, espérant quoi ? Avoir plus de temps pour se préparer au <span class=definition_txt title="départ, voyage, exode dans ce cas">tashi</span> ? Espérais-tu tenir face à la <span class=definition_txt title="déferlante, ouragan">guguwa</span> ? Avec si peu ?<br>La <span class=definition_txt title="première vague">farko kalama</span> s’est abattue sur les quelques brises-vent que vous aviez érigés, balayant tout, emportant dans son sillage le visage masqué de nombre des tiens.<br>Elle est passée. Maintenant plus le choix, tu dois entreprendre le <span class=definition_txt title="départ, voyage, exode dans ce cas">tashi</span> pour te rendre à la forteresse des montagnes la plus proche avant l’arrivée de la <span class=definition_txt title="déferlante, ouragan">guguwa</span>.<br>Avec encore moins que… prévu ?</p>
        <p style="text-align: center;"><button onclick='start();'>Commencer !</button></p>
    </div>

    <div id="stat_div" style="flex: 1;">
        <!---->
    </div>
</div>
    <footer>
        Ce jeu est écrit en javascript. Sentez-vous libre de regarder le code : clic droit puis "Code source de la page".
        <!--<br><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" style="cursor:pointer"/></a>-->
    </footer>
</html>